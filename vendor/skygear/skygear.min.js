!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.skygear=e()}}(function(){var e;return function t(e,n,r){function i(u,s){if(!n[u]){if(!e[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[u]={exports:{}};e[u][0].call(l.exports,function(t){var n=e[u][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return y[e]||0}Object.defineProperty(n,"__esModule",{value:!0}),n.AccessLevel=void 0;var s,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("lodash"),l=r(c),f=e("./role"),h=r(f),p=e("./user"),d=r(p),v=n.AccessLevel={NoAccessLevel:null,ReadOnlyLevel:"read",ReadWriteLevel:"write"},y=(s={},o(s,v.NoAccessLevel,0),o(s,v.ReadOnlyLevel,1),o(s,v.ReadWriteLevel,2),s),_=function(){function e(t){var n=this;i(this,e),this["public"]=v.ReadOnlyLevel,this.roles={},this.users={},t&&!function(){n["public"]=v.NoAccessLevel;var e=n;l["default"].forEach(t,function(t){if(t.level=t.level||v.ReadOnlyLevel,t["public"])u(t.level)>u(e["public"])&&(e["public"]=t.level);else if(t.role){var n=h["default"].define(t.role),r=e.roles[n.name];u(t.level)>u(r)&&(e.roles[n.name]=t.level)}else{if(!t.user_id)throw new Error("Invalid ACL Entry: "+JSON.stringify(t));var i=new d["default"]({user_id:t.user_id}),o=e.users[i.id];u(t.level)>u(o)&&(e.users[i.id]=t.level)}})}()}return a(e,[{key:"toJSON",value:function(){var e=[];return this["public"]&&e.push({"public":!0,level:this["public"]}),l["default"].map(this.roles,function(t,n){t&&e.push({role:n,level:t})}),l["default"].map(this.users,function(t,n){t&&e.push({user_id:n,level:t})}),e}},{key:"setPublicNoAccess",value:function(){this["public"]=v.NoAccessLevel}},{key:"setPublicReadOnly",value:function(){this["public"]=v.ReadOnlyLevel}},{key:"setPublicReadWriteAccess",value:function(){this["public"]=v.ReadWriteLevel}},{key:"setNoAccessForRole",value:function(e){if(!(e&&e instanceof h["default"]))throw new Error(e+" is not a role.");this.roles[e.name]=v.NoAccessLevel}},{key:"setReadOnlyForRole",value:function(e){if(!(e&&e instanceof h["default"]))throw new Error(e+" is not a role.");this.roles[e.name]=v.ReadOnlyLevel}},{key:"setReadWriteAccessForRole",value:function(e){if(!(e&&e instanceof h["default"]))throw new Error(e+" is not a role.");this.roles[e.name]=v.ReadWriteLevel}},{key:"setNoAccessForUser",value:function(e){if(!(e&&e instanceof d["default"]))throw new Error(e+" is not a user.");this.users[e.id]=v.NoAccessLevel}},{key:"setReadOnlyForUser",value:function(e){if(!(e&&e instanceof d["default"]))throw new Error(e+" is not a user.");this.users[e.id]=v.ReadOnlyLevel}},{key:"setReadWriteAccessForUser",value:function(e){if(!(e&&e instanceof d["default"]))throw new Error(e+" is not a user.");this.users[e.id]=v.ReadWriteLevel}},{key:"hasPublicReadAccess",value:function(){return u(this["public"])>=u(v.ReadOnlyLevel)}},{key:"hasPublicWriteAccess",value:function(){return u(this["public"])===u(v.ReadWriteLevel)}},{key:"hasReadAccess",value:function(e){return this.hasReadAccessForRole(e)}},{key:"hasWriteAccess",value:function(e){return this.hasWriteAccessForRole(e)}},{key:"hasReadAccessForRole",value:function(e){if(!(e&&e instanceof h["default"]))throw new Error(e+" is not a role.");return this.hasPublicReadAccess()||u(this.roles[e.name])>=u(v.ReadOnlyLevel)}},{key:"hasWriteAccessForRole",value:function(e){if(!(e&&e instanceof h["default"]))throw new Error(e+" is not a role.");return this.hasPublicWriteAccess()||u(this.roles[e.name])>=u(v.ReadWriteLevel)}},{key:"hasReadAccessForUser",value:function(e){if(!(e&&e instanceof d["default"]))throw new Error(e+" is not a user.");var t=e.roles;if(this.hasPublicReadAccess()||u(this.users[e.id])>=u(v.ReadOnlyLevel))return!0;var n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;if(this.hasReadAccessForRole(a))return!0}}catch(c){r=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}return!1}},{key:"hasWriteAccessForUser",value:function(e){if(!(e&&e instanceof d["default"]))throw new Error(e+" is not a user.");var t=e.roles;if(this.hasPublicWriteAccess()||u(this.users[e.id])>=u(v.ReadWriteLevel))return!0;var n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;if(this.hasWriteAccessForRole(a))return!0}}catch(c){r=!0,i=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}return!1}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}();n["default"]=_},{"./role":15,"./user":18,lodash:43}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){for(var t=(0,s.atob)(e),n=new ArrayBuffer(t.length),r=new Uint8Array(n),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);var o=new c["default"]([n]);return o}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("Base64"),a=e("w3c-blob"),c=r(a),l=function(){function e(t){i(this,e),t=t||{};var n=t.name,r=t.file,u=t.contentType,s=t.url,a=t.base64;if(!n)throw new Error("Name should not be empty");if(r){if(!u&&r.type&&(u=r.type),!u)throw new Error("ContentType cannot be inferred from file, please provide a content type manually")}else if(s);else{if(!a)throw new Error("Either file or url should present");r=o(a)}this.name=n,this.file=r,this.contentType=u,this.url=s}return u(e,[{key:"toJSON",value:function(){return{$type:"asset",$name:this.name,$url:this.url}}}],[{key:"fromJSON",value:function(t){return new e({name:t.$name,url:t.$url,contentType:t.$content_type})}}]),e}();n["default"]=l,t.exports=n["default"]},{Base64:20,"w3c-blob":58}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./store"),s=r(u),a=function(){function e(t){i(this,e),this._maxRetryCount=1,this.prefix=t,this.map={},this.store=(0,s["default"])()}return o(e,[{key:"_applyNamespaceOnKey",value:function(e){return this.prefix+":"+e}},{key:"set",value:function(e,t){var n=this._applyNamespaceOnKey(e);this.map[n]=t;var r=JSON.stringify(t);return this._setWithRetry(n,r)}},{key:"_setWithRetry",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.store.setPurgeableItem(e,t)["catch"](function(r){return n>=this._maxRetryCount?Promise.reject(r):this._setWithRetry(e,t,n+1)}.bind(this))}},{key:"get",value:function(e){var t=this._applyNamespaceOnKey(e);return this.map[t]?Promise.resolve(this.map[t]):this.store.getItem(t).then(function(e){if(e){var t=JSON.parse(e);return t}return Promise.reject()})}}]),e}();n["default"]=a,t.exports=n["default"]},{"./store":16}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(e&&e.body)return e.body;if(e&&e.text)try{return JSON.parse(e.text)}catch(t){console.log("getRespJSON error. error: ",t)}return{}}Object.defineProperty(n,"__esModule",{value:!0}),n.USER_CHANGED=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("./asset"),l=r(c),f=e("./user"),h=r(f),p=e("./role"),d=r(p),v=e("./acl"),y=r(v),_=e("./record"),g=r(_),m=e("./reference"),b=r(m),w=e("./query"),k=r(w),O=e("./database"),R=r(O),x=e("./pubsub"),A=r(x),j=e("./relation"),E=e("./geolocation"),T=r(E),P=e("./store"),S=r(P),I=e("./type"),C=e("./error"),N=e("./util"),q=e("superagent"),D=e("lodash"),U=e("event-emitter"),$=n.USER_CHANGED="userChanged",L=function(){function e(){i(this,e),this.url="http://myapp.skygeario.com/",this.apiKey=null,this.token=null,this._accessToken=null,this._user=null,this._deviceID=null,this._getAccessToken(),this._getDeviceID(),this._privateDB=null,this._publicDB=null,this.request=q,this._internalPubsub=new A["default"](this,(!0)),this._relation=new j.RelationAction(this),this._pubsub=new A["default"](this,(!1)),this.autoPubsub=!0,this._cacheResponse=!0,this.ee=U({}),this.timeoutOptions={response:6e4}}return a(e,[{key:"config",value:function(e){e.apiKey&&(this.apiKey=e.apiKey),e.endPoint&&(this.endPoint=e.endPoint);var t=[this._getUser(),this._getAccessToken(),this._getDeviceID()],n=this;return Promise.all(t).then(function(){return n.reconfigurePubsubIfNeeded(),n},function(){return n})}},{key:"configApiKey",value:function(e){this.apiKey=e}},{key:"clearCache",value:function(){return this.store.clearPurgeableItems()}},{key:"onUserChanged",value:function(e){return this.ee.on($,e),new N.EventHandle(this.ee,$,e)}},{key:"signupWithUsername",value:function(e,t){return this._signup(e,null,t)}},{key:"signupWithEmail",value:function(e,t){return this._signup(null,e,t)}},{key:"signupWithUsernameAndProfile",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.signupWithUsername(e,t).then(function(e){return n._createProfile(e,r)})}},{key:"signupWithEmailAndProfile",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.signupWithEmail(e,t).then(function(e){return n._createProfile(e,r)})}},{key:"signupAnonymously",value:function(){return this._signup(null,null,null)}},{key:"_signup",value:function(e,t,n){var r=this;return new Promise(function(i,o){r.makeRequest("auth:signup",{username:e,email:t,password:n}).then(r._authResolve.bind(r)).then(i,o)})}},{key:"_createProfile",value:function(e,t){var n=new this.UserRecord(s({_id:"user/"+e.id},t));return this.publicDB.save(n)}},{key:"_authResolve",value:function(e){var t=this;return Promise.all([this._setUser(e.result),this._setAccessToken(e.result.access_token)]).then(function(){return t.reconfigurePubsubIfNeeded(),t.currentUser})}},{key:"loginWithUsername",value:function(e,t){var n=this;return new Promise(function(r,i){n.makeRequest("auth:login",{username:e,password:t}).then(n._authResolve.bind(n)).then(r,i)})}},{key:"loginWithEmail",value:function(e,t){var n=this;return new Promise(function(r,i){n.makeRequest("auth:login",{email:e,password:t}).then(n._authResolve.bind(n)).then(r,i)})}},{key:"loginWithProvider",value:function(e,t){var n=this;return new Promise(function(r,i){n.makeRequest("auth:login",{provider:e,auth_data:t}).then(n._authResolve.bind(n)).then(r,i)})}},{key:"logout",value:function(){var e=this;return this.unregisterDevice().then(function(){return e.clearCache(),e.makeRequest("auth:logout",{})},function(t){return t.code===C.ErrorCodes.InvalidArgument&&"Missing device id"===t.message?(e.clearCache(),e.makeRequest("auth:logout",{})):Promise.reject(t)}).then(function(){return Promise.all([e._setAccessToken(null),e._setUser(null)]).then(function(){return null})},function(t){return e._setAccessToken(null).then(function(){return Promise.reject(t)})})}},{key:"whoami",value:function(){var e=this;return new Promise(function(t,n){e.makeRequest("me",{}).then(e._authResolve.bind(e)).then(t,n)})}},{key:"changePassword",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)throw Error("Invalidate is not yet implemented");var r=this;return new Promise(function(n,i){r.makeRequest("auth:password",{old_password:e,password:t}).then(r._authResolve.bind(r)).then(n,i)})}},{key:"saveUser",value:function(e){var t=this;return new Promise(function(n,r){var i={_id:e.id,email:e.email,username:e.username};e.roles&&(i.roles=D.map(e.roles,function(e){return e.name})),t.makeRequest("user:update",i).then(function(e){var n=t.User.fromJSON(e.result),r=t.currentUser;return n&&r&&n.id===r.id?t._setUser(e.result):n}).then(function(e){n(e)},function(e){r(e)})})}},{key:"_getUsersBy",value:function(e,t){var n=this;return new Promise(function(r,i){n.makeRequest("user:query",{emails:e,usernames:t}).then(function(e){for(var t=e.result,i=t.length,o=new Array(i),u=0;u<i;u++)o[u]=new n.User(t[u].data);r(o)},function(e){i(e)})})}},{key:"getUsersByEmail",value:function(e){return this._getUsersBy(e,null)}},{key:"getUsersByUsername",value:function(e){return this._getUsersBy(null,e)}},{key:"discoverUserByEmails",value:function(e){var t=this;return new Promise(function(n,r){var i=new k["default"](t.UserRecord);i.havingEmails(e),t.publicDB.query(i).then(function(e){n(e)},function(e){r(e)})})}},{key:"discoverUserByUsernames",value:function(e){var t=this;return new Promise(function(n,r){var i=new k["default"](t.UserRecord);i.havingUsernames(e),t.publicDB.query(i).then(function(e){n(e)},function(e){r(e)})})}},{key:"setAdminRole",value:function(e){var t=D.map(e,function(e){return e.name}),n=this;return new Promise(function(e,r){n.makeRequest("role:admin",{roles:t}).then(function(t){e(t.result)},function(e){r(e)})})}},{key:"setDefaultRole",value:function(e){var t=D.map(e,function(e){return e.name}),n=this;return new Promise(function(e,r){n.makeRequest("role:default",{roles:t}).then(function(t){e(t.result)},function(e){r(e)})})}},{key:"setDefaultACL",value:function(e){this.Record.defaultACL=e}},{key:"setRecordCreateAccess",value:function(e,t){var n=D.map(t,function(e){return e.name}),r=this;return new Promise(function(t,i){r.makeRequest("schema:access",{type:e.recordType,create_roles:n}).then(function(e){t(e.result)},function(e){i(e)})})}},{key:"setRecordDefaultAccess",value:function(e,t){var n=this;return new Promise(function(r,i){n.makeRequest("schema:default_access",{type:e.recordType,default_access:t.toJSON()}).then(function(e){r(e.result)},function(e){i(e)})})}},{key:"inferDeviceType",value:function(){throw new Error("Failed to infer type, please supply a value")}},{key:"registerDevice",value:function(e,t,n){if(!e)throw new Error("Token cannot be empty");t||(t=this.inferDeviceType());var r=void 0;this.deviceID&&(r=this.deviceID);var i=this;return i.makeRequest("device:register",{type:t,id:r,topic:n,device_token:e}).then(function(e){return i._setDeviceID(e.result.id)},function(n){var r=null;return n.error&&(r=n.error.code),i.deviceID&&r===C.ErrorCodes.ResourceNotFound?i._setDeviceID(null).then(function(){return i.registerDevice(e,t)}):Promise.reject(n)})}},{key:"unregisterDevice",value:function(){if(!this.deviceID)return Promise.reject(new C.SkygearError("Missing device id",C.ErrorCodes.InvalidArgument));var e=this;return e.makeRequest("device:unregister",{id:this.deviceID}).then(function(){},function(t){var n=null;return t.error&&(n=t.error.code),n===C.ErrorCodes.ResourceNotFound?e._setDeviceID(null):Promise.reject(t)})}},{key:"lambda",value:function(e,t){var n=this;return new Promise(function(r,i){n.makeRequest(e,{args:t}).then(function(e){r(e.result)},i)})}},{key:"makeUploadAssetRequest",value:function(e){var t=this;return new Promise(function(n,r){t.makeRequest("asset:put",{filename:e.name,"content-type":e.contentType,"content-size":e.file.size}).then(function(i){var o=l["default"].fromJSON(i.result.asset),u=i.result["post-request"],s=u.action;0===s.indexOf("/")&&(s=s.substring(1)),0!==s.indexOf("http")&&(s=t.url+s);var a=t.request.post(s).set("X-Skygear-API-Key",t.apiKey);u["extra-fields"]&&D.forEach(u["extra-fields"],function(e,t){a=a.field(t,e)}),a.attach("file",e.file).end(function(e){return e?void r(e):void n(o)})},function(e){r(e)})})}},{key:"sendRequestObject",value:function(e,t){if(null===this.apiKey)throw Error("Please config ApiKey");var n=D.assign({action:e,api_key:this.apiKey,access_token:this.accessToken},t),r=e.replace(/:/g,"/"),i=this.request.post(this.url+r).set("X-Skygear-API-Key",this.apiKey).set("X-Skygear-Access-Token",this.accessToken).set("Accept","application/json");return void 0!==this.timeoutOptions&&null!==this.timeoutOptions&&(i=i.timeout(this.timeoutOptions)),i.send(n)}},{key:"makeRequest",value:function(e,t){var n=this,r=this.sendRequestObject(e,t);return new Promise(function(e,t){r.end(function(r,i){var s=o(i);if(r){var a=function(){var e=s.error||r;return e.code===n.ErrorCodes.AccessTokenNotAccepted?{v:Promise.all([n._setAccessToken(null),n._setUser(null)]).then(function(){t({status:r.status,error:e})})}:void t({status:r.status,error:e})}();if("object"===("undefined"==typeof a?"undefined":u(a)))return a.v}else e(s)})})}},{key:"_getUser",value:function(){var e=this;return this.store.getItem("skygear-user").then(function(t){var n=JSON.parse(t);e._user=e.User.fromJSON(n)},function(t){return console.warn("Failed to get user",t),e._user=null,null})}},{key:"_setUser",value:function(e){var t=this,n=void 0;null!==e?(this._user=new this.User(e),n=JSON.stringify(this._user.toJSON())):(this._user=null,n=null);var r=null===n?this.store.removeItem("skygear-user"):this.store.setItem("skygear-user",n);return r.then(function(){return t.ee.emit($,t._user),n},function(e){return console.warn("Failed to persist user",e),n})}},{key:"_getAccessToken",value:function(){var e=this;return this.store.getItem("skygear-accesstoken").then(function(t){return e._accessToken=t,t},function(t){return console.warn("Failed to get access",t),e._accessToken=null,null})}},{key:"_setAccessToken",value:function(e){this._accessToken=e;var t=null===e?this.store.removeItem("skygear-accesstoken"):this.store.setItem("skygear-accesstoken",e);return t.then(function(){return e},function(t){return console.warn("Failed to persist accesstoken",t),e})}},{key:"_getDeviceID",value:function(){var e=this;return this.store.getItem("skygear-deviceid").then(function(t){return e._deviceID=t,t},function(t){return console.warn("Failed to get deviceid",t),e._deviceID=null,null})}},{key:"_setDeviceID",value:function(e){var t=this;this._deviceID=e;var n=null===e?this.store.removeItem("skygear-deviceid"):this.store.setItem("skygear-deviceid",e);return n.then(function(){return e},function(t){return console.warn("Failed to persist deviceid",t),e}).then(function(e){return t.reconfigurePubsubIfNeeded(),e})}},{key:"reconfigurePubsubIfNeeded",value:function(){this.autoPubsub&&(this._internalPubsub.reset(),null!==this.deviceID&&this._internalPubsub.subscribe("_sub_"+this.deviceID,function(e){console.log("Receivied data for subscription: "+e)}),this._internalPubsub.reconfigure(),this._pubsub.reconfigure())}},{key:"on",value:function(e,t){return this.pubsub.on(e,t)}},{key:"off",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pubsub.off(e,t)}},{key:"defaultACL",get:function(){return this.Record.defaultACL}},{key:"Query",get:function(){return k["default"]}},{key:"User",get:function(){return h["default"]}},{key:"Role",get:function(){return d["default"]}},{key:"ACL",get:function(){return y["default"]}},{key:"Record",get:function(){return g["default"]}},{key:"UserRecord",get:function(){return g["default"].extend("user")}},{key:"Sequence",get:function(){return I.Sequence}},{key:"Asset",get:function(){return l["default"]}},{key:"Reference",get:function(){return b["default"]}},{key:"Geolocation",get:function(){return T["default"]}},{key:"ErrorCodes",get:function(){return C.ErrorCodes}},{key:"currentUser",get:function(){return this._user}},{key:"cacheResponse",get:function(){return this._cacheResponse},set:function(e){var t=!!e;this._cacheResponse=t,this._publicDB&&(this._publicDB.cacheResponse=t),this._privateDB&&(this._privateDB.cacheResponse=t)}},{key:"accessToken",get:function(){return this._accessToken}},{key:"deviceID",get:function(){return this._deviceID}},{key:"endPoint",get:function(){return this.url},set:function(e){e&&(this.url=e)}},{key:"store",get:function(){return this._store||(this._store=(0,S["default"])()),this._store}},{key:"publicDB",get:function(){return null===this._publicDB&&(this._publicDB=new R["default"]("_public",this),this._publicDB.cacheResponse=this._cacheResponse),this._publicDB}},{key:"privateDB",get:function(){if(null===this.accessToken)throw new Error("You must login before access to privateDB");return null===this._privateDB&&(this._privateDB=new R["default"]("_private",this),this._privateDB.cacheResponse=this._cacheResponse),this._privateDB}},{key:"Database",get:function(){return R["default"]}},{key:"relation",get:function(){return this._relation}},{key:"pubsub",get:function(){return this._pubsub}}]),e}();n["default"]=L},{"./acl":1,"./asset":2,"./database":5,"./error":6,"./geolocation":7,"./pubsub":9,"./query":10,"./record":12,"./reference":13,"./relation":14,"./role":15,"./store":16,"./type":17,"./user":18,"./util":19,"event-emitter":40,lodash:43,superagent:49}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(a){i=!0,o=a}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./cache"),a=r(s),c=e("./asset"),l=r(c),f=e("./record"),h=r(f),p=e("./query"),d=r(p),v=e("./query_result"),y=r(v),_=e("lodash"),g=function(){function e(t,n){if(i(this,e),"_public"!==t&&"_private"!==t&&"_union"!==t)throw new Error("Invalid database_id");this.dbID=t,this.container=n,this._cacheStore=new a["default"](this.dbID),this._cacheResponse=!0}return u(e,[{key:"getRecordByID",value:function(e){var t=this,n=h["default"].parseID(e),r=o(n,2),i=r[0],u=r[1],s=new d["default"](h["default"].extend(i)).equalTo("_id",u);return new Promise(function(n,r){t.query(s).then(function(t){1===t.length?n(t[0]):r(new Error(e+" does not exist"))},r)})}},{key:"query",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1,r=this.cacheStore,i=e.recordCls,o=e.toJSON();!o.offset&&o.page>0&&(o.offset=o.limit*(o.page-1));var u=_.assign({database_id:this.dbID},o);return t&&r.get(e.hash).then(function(e){if(!n){var r=_.map(e.result,function(e){return new i(e)}),o=y["default"].createFromResult(r,e.info);t(o,!0)}},function(e){console.log("No cache found",e)}),new Promise(function(t,o){this.container.makeRequest("record:query",u).then(function(o){var u=_.map(o.result,function(e){return new i(e)}),s=y["default"].createFromResult(u,o.info);n=!0,this.cacheResponse&&r.set(e.hash,o),t(s)}.bind(this),function(e){o(e)})}.bind(this))}},{key:"_presaveAssetTask",value:function(e,t){return t.file?new Promise(function(n,r){this.container.makeUploadAssetRequest(t).then(function(t){n([e,t])},function(e){r(e)})}.bind(this)):Promise.resolve([e,t])}},{key:"_presave",value:function(e){var t=this;return new Promise(function(n,r){var i=_.map(e,function(e,n){return e instanceof l["default"]?t._presaveAssetTask(n,e):Promise.resolve([n,e])});Promise.all(i).then(function(t){_.each(t,function(t){var n=o(t,2),r=n[0],i=n[1];e[r]=i}),n(e)},function(e){r(e)})})}},{key:"del",value:function(e){return this["delete"](e)}},{key:"save",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,r=e;return _.isArray(r)||(r=[r]),new Promise(function(e,i){_.map(r,function(e){void 0!==e&&null!==e||i("Invalid input, unable to save undefined and null")});var o=_.map(r,n._presave.bind(n));Promise.all(o).then(function(e){var r={database_id:n.dbID};return t.atomic&&(r.atomic=!0),r.records=_.map(e,function(e){return e.toJSON()}),n.container.makeRequest("record:save",r)}).then(function(t){var n=t.result,o=[],u=[];_.forEach(n,function(e,t){"error"===e._type?(o[t]=void 0,u[t]=e):(r[t].update(e),r[t].updateTransient(e._transient,!0),o[t]=r[t],u[t]=void 0)}),1===r.length?u[0]?i(u[0]):e(o[0]):e({savedRecords:o,errors:u})},function(e){i(e)})["catch"](function(e){i(e)})})}},{key:"delete",value:function(e){var t=this,n=e;_.isArray(n)||(n=[n]);var r=_.map(n,function(e){return e.id}),i={database_id:this.dbID,ids:r};return new Promise(function(e,r){t.container.makeRequest("record:delete",i).then(function(t){var i=t.result,o=[];_.forEach(i,function(e,t){"error"===e._type?o[t]=e:o[t]=void 0}),1===n.length?o[0]?r(o[0]):e():e(o)},function(e){r(e)})})}},{key:"cacheStore",get:function(){return this._cacheStore}},{key:"cacheResponse",get:function(){return this._cacheResponse},set:function(e){var t=!!e;this._cacheResponse=t}}]),e}();n["default"]=g,t.exports=n["default"]},{"./asset":2,"./cache":3,"./query":10,"./query_result":11,"./record":12,lodash:43}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}function a(e){return f["default"].findKey(h,function(t){return e===t})}Object.defineProperty(n,"__esModule",{value:!0}),n.SkygearError=n.ErrorCodes=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("lodash"),f=r(l),h=n.ErrorCodes={NotAuthenticated:101,PermissionDenied:102,AccessKeyNotAccepted:103,AccessTokenNotAccepted:104,InvalidCredentials:105,InvalidSignature:106,BadRequest:107,InvalidArgument:108,Duplicated:109,ResourceNotFound:110,NotSupported:111,NotImplemented:112,ConstraintViolated:113,IncompatibleSchema:114,AtomicOperationFailure:115,PartialOperationFailure:116,UndefinedOperation:117,PluginUnavailable:118,PluginTimeout:119,RecordQueryInvalid:120,PluginInitializing:121,UnexpectedError:1e4};n.SkygearError=function(e){function t(e,n,r){i(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return u.message=e,u.code=n||h.UnexpectedError,u.info=r||null,u}return u(t,e),c(t,[{key:"toString",value:function(){return"SkygearError: "+this.message}},{key:"toLocaleString",value:function(){switch(this.code){case h.NotAuthenticated:return"You have to be authenticated to perform this operation.";case h.PermissionDenied:case h.AccessKeyNotAccepted:case h.AccessTokenNotAccepted:return"You are not allowed to perform this operation.";case h.InvalidCredentials:return"You are not allowed to log in because the credentials you provided are not valid.";case h.InvalidSignature:case h.BadRequest:return"The server is unable to process the request.";case h.InvalidArgument:return"The server is unable to process the data.";case h.Duplicated:return"This request contains duplicate of an existing resource on the server.";case h.ResourceNotFound:return"The requested resource is not found.";case h.NotSupported:return"This operation is not supported.";case h.NotImplemented:return"This operation is not implemented.";case h.ConstraintViolated:case h.IncompatibleSchema:case h.AtomicOperationFailure:case h.PartialOperationFailure:return"A problem occurred while processing this request.";case h.UndefinedOperation:return"The requested operation is not available.";case h.PluginInitializing:case h.PluginUnavailable:return"The server is not ready yet.";case h.PluginTimeout:return"The server took too long to process.";case h.RecordQueryInvalid:return"A problem occurred while processing this request.";default:return"An unexpected error has occurred."}}},{key:"toJSON",value:function(){var e={name:a(this.code),code:this.code,message:this.message};return this.info&&(e.info=this.info),e}}],[{key:"fromJSON",value:function(e){return new t(e.message,e.code||h.UnexpectedError,e.info||null)}}]),t}(s(Error))},{lodash:43}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("lodash"),s=r(u),a=function(){function e(t,n){if(i(this,e),!s["default"].isNumber(t))throw new Error("Latitude is not a number");if(t<-90||t>90)throw new Error("Latitude is not in expected range (-90, 90)");if(!s["default"].isNumber(n))throw new Error("Longitude is not a number");if(n<-180||n>180)throw new Error("Longitude is not in expected range (-180, 180)");this.latitude=t,this.longitude=n}return o(e,[{key:"toJSON",value:function(){return{$lat:this.latitude,$lng:this.longitude,$type:"geo"}}}],[{key:"fromJSON",value:function(t){return new e(t.$lat,t.$lng)}}]),e}();n["default"]=a,t.exports=n["default"]},{lodash:43}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./container"),o=r(i),u=new o["default"];n["default"]=u,t.exports=n["default"]},{"./container":4}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r);
}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./util"),u=e("lodash"),s=e("websocket"),a=null;a=s?s.w3cwebsocket:window.WebSocket;var c=e("url"),l=e("event-emitter"),f="onOpen",h="onClose",p=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r(this,e),this._container=t,this._ws=null,this._internal=n,this._queue=[],this.ee=l({}),this._handlers={},this._reconnectWait=5e3,this._retryCount=0}return i(e,[{key:"onOpen",value:function(e){return this.ee.on(f,e),new o.EventHandle(this.ee,f,e)}},{key:"onClose",value:function(e){return this.ee.on(h,e),new o.EventHandle(this.ee,h,e)}},{key:"_pubsubUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=c.parse(this._container.endPoint),n="https:"===t.protocol?"wss:":"ws:",r=e?"/_/pubsub":"/pubsub",i="?api_key="+this._container.apiKey;return n+"//"+t.host+r+i}},{key:"_hasCredentials",value:function(){return!!this._container.apiKey}},{key:"reconfigure",value:function(){return this._hasCredentials()?void this.connect():void this.close()}},{key:"_onopen",value:function(){var e=this;this.ee.emit(f,!0),u.forEach(this._handlers,function(t,n){e._sendSubscription(n)}),u.forEach(this._queue,function(t){e._ws.send(JSON.stringify(t))}),this._queue=[]}},{key:"_onmessage",value:function(e){u.forEach(this._handlers[e.channel],function(t){t(e.data)})}},{key:"on",value:function(e,t){return this.subscribe(e,t)}},{key:"once",value:function(e){var t=this;return new Promise(function(n){function r(i){t.unsubscribe(e,r),n(i)}t.subscribe(e,r)})}},{key:"publish",value:function(e,t){if(!e)throw new Error("Missing channel to publish");if(!t)throw new Error("Missing data to publish");var n={action:"pub",channel:e,data:t};this.connected?this._ws.send(JSON.stringify(n)):this._queue.push(n)}},{key:"_sendSubscription",value:function(e){if(this.connected){var t={action:"sub",channel:e};this._ws.send(JSON.stringify(t))}}},{key:"_sendRemoveSubscription",value:function(e){if(this.connected){var t={action:"unsub",channel:e};this._ws.send(JSON.stringify(t))}}},{key:"off",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.unsubscribe(e,t)}},{key:"subscribe",value:function(e,t){if(!e)throw new Error("Missing channel to subscribe");var n=this.hasHandlers(e);return this._register(e,t),n||this._sendSubscription(e),t}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)throw new Error("Missing channel to unsubscribe");if(this.hasHandlers(e)){var n;n=t?[t]:this._handlers[e];var r=this;u.forEach(n,function(t){r._unregister(e,t)}),this.hasHandlers(e)||this._sendRemoveSubscription(e)}}},{key:"hasHandlers",value:function(e){var t=this._handlers[e];return!!t&&t.length>0}},{key:"_register",value:function(e,t){this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(t)}},{key:"_unregister",value:function(e,t){var n=this._handlers[e];n=u.reject(n,function(e){return e===t}),n.length>0?this._handlers[e]=n:delete this._handlers[e]}},{key:"_reconnect",value:function(){var e=this,t=u.min([this._reconnectWait*this._retryCount,6e4]);u.delay(function(){e._retryCount+=1,e.connect()},t)}},{key:"reset",value:function(){this.close(),this._handlers={}}},{key:"close",value:function(){this._ws&&(this._ws.close(),this._ws=null)}},{key:"_setWebSocket",value:function(e){var t=this.ee;if(this._ws=e,this._ws){var n=this;this._ws.onopen=function(){n._retryCount=0,n._onopen()},this._ws.onclose=function(){t.emit(h,!1),n._reconnect()},this._ws.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(r){return void console.log("Got malformed websocket data:",e.data)}n._onmessage(t)}}}},{key:"connect",value:function(){if(this._hasCredentials()&&!this.connected){var e=this._pubsubUrl(this._internal),t=new this.WebSocket(e);this._setWebSocket(t)}}},{key:"connected",get:function(){return this._ws&&1===this._ws.readyState}},{key:"WebSocket",get:function(){return a}}]),e}();n["default"]=p,t.exports=n["default"]},{"./util":19,"event-emitter":40,lodash:43,url:21,websocket:59}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("lodash"),s=r(u),a=e("md5"),c=r(a),l=e("./util"),f=e("./record"),h=r(f),p=function(){function e(t){if(i(this,e),!h["default"].validType(t.recordType))throw new Error("RecordType is not valid. Please start with alphanumeric string.");this.recordCls=t,this.recordType=t.recordType,this._predicate=[],this._orPredicate=[],this._sort=[],this._include={},this._negation=!1,this.overallCount=!1,this.limit=50,this.offset=0,this.page=0}return o(e,[{key:"like",value:function(e,t){return this._predicate.push(["like",{$type:"keypath",$val:e},t]),this}},{key:"notLike",value:function(e,t){return this._predicate.push(["not",["like",{$type:"keypath",$val:e},t]]),this}},{key:"caseInsensitiveLike",value:function(e,t){return this._predicate.push(["ilike",{$type:"keypath",$val:e},t]),this}},{key:"caseInsensitiveNotLike",value:function(e,t){return this._predicate.push(["not",["ilike",{$type:"keypath",$val:e},t]]),this}},{key:"equalTo",value:function(e,t){return this._predicate.push(["eq",{$type:"keypath",$val:e},t]),this}},{key:"notEqualTo",value:function(e,t){return this._predicate.push(["neq",{$type:"keypath",$val:e},t]),this}},{key:"greaterThan",value:function(e,t){return this._predicate.push(["gt",{$type:"keypath",$val:e},t]),this}},{key:"greaterThanOrEqualTo",value:function(e,t){return this._predicate.push(["gte",{$type:"keypath",$val:e},t]),this}},{key:"lessThan",value:function(e,t){return this._predicate.push(["lt",{$type:"keypath",$val:e},t]),this}},{key:"lessThanOrEqualTo",value:function(e,t){return this._predicate.push(["lte",{$type:"keypath",$val:e},t]),this}},{key:"distanceLessThan",value:function(e,t,n){return this._predicate.push(["lt",["func","distance",{$type:"keypath",$val:e},{$type:"geo",$lng:t.longitude,$lat:t.latitude}],n]),this}},{key:"distanceGreaterThan",value:function(e,t,n){return this._predicate.push(["gt",["func","distance",{$type:"keypath",$val:e},{$type:"geo",$lng:t.longitude,$lat:t.latitude}],n]),this}},{key:"contains",value:function(e,t){if(!s["default"].isArray(t))throw new Error("The second argument of contains must be an array.");return this._predicate.push(["in",{$type:"keypath",$val:e},t]),this}},{key:"notContains",value:function(e,t){if(!s["default"].isArray(t))throw new Error("The second argument of contains must be an array.");return this._predicate.push(["not",["in",{$type:"keypath",$val:e},t]]),this}},{key:"containsValue",value:function(e,t){if(!s["default"].isString(t))throw new Error("The second argument of containsValue must be a string.");return this._predicate.push(["in",t,{$type:"keypath",$val:e}]),this}},{key:"notContainsValue",value:function(e,t){if(!s["default"].isString(t))throw new Error("The second argument of containsValue must be a string.");return this._predicate.push(["not",["in",t,{$type:"keypath",$val:e}]]),this}},{key:"havingRelation",value:function(e,t){var n=t.prototype.identifier;return"friend"===n?n="_friend":"follow"===n&&(n="_follow"),this._predicate.push(["func","userRelation",{$type:"keypath",$val:e},{$type:"relation",$name:n,$direction:t.prototype.direction}]),this}},{key:"notHavingRelation",value:function(e,t){var n=t.prototype.identifier;return"friend"===n?n="_friend":"follow"===n&&(n="_follow"),this._predicate.push(["not",["func","userRelation",{$type:"keypath",$val:e},{$type:"relation",$name:n,$direction:t.prototype.direction}]]),this}},{key:"havingEmails",value:function(e){if("user"!==this.recordType)throw new Error("havingEmails predicate only works on user record");return s["default"].isArray(e)||(e=[e]),this._predicate.push(["func","userDiscover",{emails:e}]),this}},{key:"havingUsernames",value:function(e){if("user"!==this.recordType)throw new Error("havingUsernames predicate only works on user record");return s["default"].isArray(e)||(e=[e]),this._predicate.push(["func","userDiscover",{usernames:e}]),this}},{key:"addDescending",value:function(e){return this._sort.push([{$type:"keypath",$val:e},"desc"]),this}},{key:"addAscending",value:function(e){return this._sort.push([{$type:"keypath",$val:e},"asc"]),this}},{key:"addDescendingByDistance",value:function(e,t){return this._sort.push([["func","distance",{$type:"keypath",$val:e},{$type:"geo",$lng:t.longitude,$lat:t.latitude}],"desc"]),this}},{key:"addAscendingByDistance",value:function(e,t){return this._sort.push([["func","distance",{$type:"keypath",$val:e},{$type:"geo",$lng:t.longitude,$lat:t.latitude}],"asc"]),this}},{key:"transientInclude",value:function(e,t){return t=t||e,this._include[t]={$type:"keypath",$val:e},this}},{key:"transientIncludeDistance",value:function(e,t,n){return t=t||e,this._include[t]=["func","distance",{$type:"keypath",$val:e},{$type:"geo",$lng:n.longitude,$lat:n.latitude}],this}},{key:"_orQuery",value:function(e){var t=this;s["default"].forEach(e,function(e){t._orPredicate.push(e.predicate)})}},{key:"_getOrPredicate",value:function(){var e=s["default"].clone(this._orPredicate);return 0===e.length?[]:1===e.length?e[0]:(e.unshift("or"),e)}},{key:"toJSON",value:function(){var e={record_type:this.recordType,limit:this.limit,sort:this._sort,include:this._include,count:this.overallCount};return this.predicate.length>1&&(e.predicate=(0,l.toJSON)(this.predicate)),this.offset&&(e.offset=this.offset),this.page&&(e.page=this.page),e}},{key:"predicate",get:function(){var e=s["default"].clone(this._predicate);this._orPredicate.length>0&&e.push(this._getOrPredicate());var t=[];return 1===e.length?t=e[0]:e.length>0&&(e.unshift("and"),t=e),this._negation?["not",t]:t}},{key:"hash",get:function(){return(0,c["default"])(JSON.stringify(this.toJSON()))}}],[{key:"clone",value:function(t){return e.fromJSON(t.toJSON())}},{key:"fromJSON",value:function(t){var n=s["default"].cloneDeep(t),r=h["default"].extend(n.record_type),i=new e(r);return i.limit=n.limit,i._sort=n.sort,i.overallCount=n.count,n.offset&&(i.offset=n.offset),n.page&&(i.page=n.page),n.predicate&&n.predicate.length>1&&!function(){var e=(0,l.fromJSON)(n.predicate);"not"===e[0]&&(i._negation=!0,e=e[1]),e.length>1&&"and"===e[0]&&e.shift();var t=[],r=[];s["default"].each(e,function(e){e.length>1&&"or"===e[0]?r=e:t.push(e)}),r.length>1&&r.shift(),t.length>1&&"string"==typeof t[0]&&"and"!==t[0]&&(t=[t]),i._predicate=t,i._orPredicate=r}(),i}},{key:"or",value:function(){for(var t=null,n=null,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];s["default"].forEach(i,function(e){if(t||(t=e.recordType,n=e.recordCls),t!==e.recordType)throw new Error("All queries must be for the same recordType.")});var u=new e(n);return u._orQuery(i),u}},{key:"not",value:function(t){var n=e.clone(t);return n._negation=!n._negation,n}}]),e}();n["default"]=p,t.exports=n["default"]},{"./record":12,"./util":19,lodash:43,md5:44}],11:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"overallCount",get:function(){return this._overallCount}}],[{key:"createFromResult",value:function(e,n){var r=new t;return e.forEach(function(e){return r.push(e)}),r._overallCount=n?n.count:void 0,r}}]),t}(u(Array));n["default"]=a,t.exports=n["default"]},{}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=g.extend(e._id.split("/")[0]);return new t(e)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(a){i=!0,o=a}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("uuid"),c=r(a),l=e("lodash"),f=r(l),h=e("./util"),p=e("./acl"),d=r(p),v={_id:null,_type:null},y={_created_at:{parser:function(e){return new Date(e)},newKey:"createdAt"},_updated_at:{parser:function(e){return new Date(e)},newKey:"updatedAt"},_ownerID:{parser:function(e){return e},newKey:"ownerID"},_created_by:{parser:function(e){return e},newKey:"createdBy"},_updated_by:{parser:function(e){return e},newKey:"updatedBy"},_access:{parser:function(e){var t=e;return e&&e.toJSON&&(t=e.toJSON()),d["default"].fromJSON(t)},newKey:"_access"}},_=f["default"].map(y,function(e){return e.newKey}),g=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;if(i(this,e),!e.validType(t))throw new Error("RecordType is not valid. Please start with alphanumeric string.");this._recordType=t;var r=n.id||n._id;if(null===r||void 0===r)r=c["default"].v4();else{var o=e.parseID(r),s=u(o,2),a=s[0],l=s[1];if(a!==this._recordType)throw new Error("_id is not valid. RecordType mismatch.");r=l}delete n.id,this._id=r,this._access=null,this.update(n),this.updateTransient(n._transient)}return s(e,[{key:"setAccess",value:function(e){this._access=e}},{key:"update",value:function(e){f["default"].each(this.attributeKeys,function(e){delete this[e]},this),f["default"].each(e,function(e,t){if(0!==t.indexOf("_"))f["default"].isObject(e)?this[t]=(0,h.fromJSON)(e):this[t]=e;else if(t in y){var n=y[t];this[n.newKey]=n.parser(e)}},this)}},{key:"setPublicNoAccess",value:function(){this.access.setPublicNoAccess()}},{key:"setPublicReadOnly",value:function(){this.access.setPublicReadOnly()}},{key:"setPublicReadWriteAccess",value:function(){this.access.setPublicReadWriteAccess()}},{key:"setNoAccessForRole",value:function(e){this.access.setNoAccessForRole(e)}},{key:"setReadOnlyForRole",value:function(e){this.access.setReadOnlyForRole(e)}},{key:"setReadWriteAccessForRole",value:function(e){this.access.setReadWriteAccessForRole(e)}},{key:"setNoAccessForUser",value:function(e){this.access.setNoAccessForUser(e)}},{key:"setReadOnlyForUser",value:function(e){this.access.setReadOnlyForUser(e)}},{key:"setReadWriteAccessForUser",value:function(e){this.access.setReadWriteAccessForUser(e)}},{key:"hasPublicReadAccess",value:function(){this.access.hasPublicReadAccess()}},{key:"hasPublicWriteAccess",value:function(){this.access.hasPublicWriteAccess()}},{key:"hasReadAccess",value:function(e){this.access.hasReadAccess(e)}},{key:"hasWriteAccess",value:function(e){this.access.hasWriteAccess(e)}},{key:"hasReadAccessForRole",value:function(e){this.access.hasReadAccessForRole(e)}},{key:"hasWriteAccessForRole",value:function(e){this.access.hasWriteAccessForRole(e)}},{key:"hasReadAccessForUser",value:function(e){this.access.hasReadAccessForUser(e)}},{key:"hasWriteAccessForUser",value:function(e){this.access.hasWriteAccessForUser(e)}},{key:"updateTransient",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?f["default"].clone(this._transient):{};f["default"].each(e,function(e,t){f["default"].isObject(e)&&"_id"in e?n[t]=o(e):f["default"].isObject(e)?n[t]=(0,h.fromJSON)(e):n[t]=e}),this._transient=n}},{key:"toJSON",value:function(){var e={_id:this.id,_access:this.access&&this.access.toJSON()};return f["default"].each(this.attributeKeys,function(t){e[t]=(0,h.toJSON)(this[t])},this),e}},{key:"recordType",get:function(){return this._recordType}},{key:"id",get:function(){return this._recordType+"/"+this._id}},{key:"access",get:function(){return this._access}},{key:"attributeKeys",get:function(){var e=Object.keys(this);return f["default"].filter(e,function(e){return 0!==e.indexOf("_")&&!f["default"].includes(_,e)})}},{key:"$transient",get:function(){return this._transient}}],[{key:"validType",value:function(e){return e&&0!==e.indexOf("_")}},{key:"parseID",value:function(e){var t=e.split("/");if(t.length<2)throw new Error("_id is not valid. _id has to be in the format `type/id`");return[t[0],t.slice(1).join("/")]}},{key:"extend",value:function(t,n){function r(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;e.call(this,t,n)}if(!e.validType(t))throw new Error("RecordType is not valid. Please start with alphanumeric string.");var i={};return f["default"].assign(i,n,{constructor:r}),r.prototype=f["default"].create(e.prototype,i),r.recordType=t,r}}]),e}();n["default"]=g,t.exports=n["default"]},{"./acl":1,"./util":19,lodash:43,uuid:57}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./record"),s=r(u),a=function(){function e(t){i(this,e);var n;if("string"==typeof t?n=t:(n=t.$id,n||(n=t.id)),!n)throw new Error("Empty record id");s["default"].parseID(n),this._id=n}return o(e,[{key:"toJSON",value:function(){return{$id:this._id,$type:"ref"}}},{key:"id",get:function(){return this._id}}]),e}();n["default"]=a,t.exports=n["default"]},{"./record":12}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.RelationAction=n.RelationQueryResult=n.RelationRemoveResult=n.RelationResult=n.RelationQuery=n.Relation=n.Mutual=n.Inward=n.Outward=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("./user"),l=r(c),f=e("lodash"),h=n.Outward="outward",p=n.Inward="inward",d=n.Mutual="mutual",v=/^[a-zA-Z]+$/,y=n.Relation=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(s(this,e),!e.validName(t))throw new Error("Relation identifier can only be [a-zA-Z]+");if(this.identifier=t,!e.validDirection(n))throw new Error("Relation direction not supported.");this.direction=n,this.targets=r,this.fails=[]}return a(e,[{key:"targetsID",get:function(){return f.map(this.targets,function(e){return e.id})}}],[{key:"validDirection",value:function(e){return e===d||e===h||e===p}},{key:"validName",value:function(e){return v.test(e)}}]),e}(),_=n.RelationQuery=function(){function e(t){s(this,e),this.identifier=t.prototype.identifier,this.direction=t.prototype.direction,this.limit=50,this.page=0}return a(e,[{key:"toJSON",value:function(){return{name:this.identifier,direction:this.direction,limit:this.limit,page:this.page}}}]),e}(),g=n.RelationResult=function w(e){s(this,w),this.success=[],this.fails=[],this.partialError=!1;for(var t=e.length,n=0;n<t;n++)"error"===e[n].type?(this.fails.push(e[n]),this.partialError=!0):this.success.push(new l["default"](e[n].data))},m=n.RelationRemoveResult=function k(e){s(this,k),this.success=[],this.fails=[],this.partialError=!1;for(var t=e.length,n=0;n<t;n++)"error"===e[n].type?(this.fails.push(e[n]),this.partialError=!0):this.success.push(e[n].id)},b=n.RelationQueryResult=function(e){function t(){return s(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"overallCount",get:function(){return this._overallCount}}],[{key:"createFromBody",value:function(e){var n=f.map(e.result,function(e){return new l["default"](e.data)}),r=new t;n.forEach(function(e){return r.push(e)});var i=e.info;return r._overallCount=i?i.count:void 0,r}}]),t}(u(Array));n.RelationAction=function(){function e(t){s(this,e),this.container=t}return a(e,[{key:"query",value:function(e){var t=this;return new Promise(function(n,r){t.container.makeRequest("relation:query",e.toJSON()).then(function(e){var t=b.createFromBody(e);n(t)},function(e){r(e)})})}},{key:"queryFriend",value:function(e){null===e&&(e=this.container.currentUser);var t=new _(this.Friend);return t.user=e,this.query(t)}},{key:"queryFollower",value:function(e){null===e&&(e=this.container.currentUser);var t=new _(this.Follower);return t.user=e,this.query(t)}},{key:"queryFollowing",value:function(e){null===e&&(e=this.container.currentUser);var t=new _(this.Following);return t.user=e,this.query(t)}},{key:"add",value:function(e){return new Promise(function(t,n){this.container.makeRequest("relation:add",{name:e.identifier,direction:e.direction,targets:e.targetsID}).then(function(e){var n=new g(e.result);t(n)},function(e){n(e)})}.bind(this))}},{key:"remove",value:function(e){return new Promise(function(t,n){this.container.makeRequest("relation:remove",{name:e.identifier,direction:e.direction,targets:e.targetsID}).then(function(e){var n=new m(e.result);t(n)},function(e){n(e)})}.bind(this))}},{key:"Query",get:function(){return _}},{key:"Friend",get:function(){return e.extend("friend",d)}},{key:"Follower",get:function(){return e.extend("follow",p)}},{key:"Following",get:function(){return e.extend("follow",h)}}],[{key:"extend",value:function(e,t){function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];y.call(this,e,t),this.targets=n}if(!y.validName(e))throw new Error("Relation identifier can only be [a-zA-Z]+");var r={identifier:e,direction:t};return n.prototype=f.create(y.prototype,r),n}}]),e}()},{"./user":18,lodash:43}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("lodash"),s=r(u),a={},c=function(){function e(t){if(i(this,e),!e.isValidName(t))throw new Error("Role name is not valid. Please start with alphanumeric string.");this._name=t}return o(e,[{key:"name",get:function(){return this._name}}],[{key:"isValidName",value:function(e){return!!e}},{key:"define",value:function(t){var n=a[t];return void 0!==n?n:(n=new e(t),a[t]=n,n)}},{key:"union",value:function(e,t){var n=s["default"].find(e,function(e){return e.name===t.name});return void 0===n?s["default"].union(e,[t]):e}},{key:"subtract",value:function(e,t){return s["default"].filter(e,function(e){return e.name!==t.name})}},{key:"contain",value:function(e,t){return void 0!==s["default"].find(e,function(e){return e.name===t.name})}}]),e}();n["default"]=c,t.exports=n["default"]},{lodash:43}],16:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.setStore=void 0;var i,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("cookie-storage"),s=e("./util"),a=["skygear-deviceid","skygear-user","skygear-accesstoken"],c="_skygear_purgeable_keys_",l=function(){function e(t){r(this,e),this._syncImpl=t}return o(e,[{key:"clear",value:function(e){return new Promise(function(t){this._syncImpl.clear(),e&&e(null),t()}.bind(this))}},{key:"getItem",value:function(e,t){return new Promise(function(n){var r=this._syncImpl.getItem(e);t&&t(null,r),n(r)}.bind(this))}},{key:"setItem",value:function(e,t,n){return new Promise(function(r,i){try{this._syncImpl.setItem(e,t),n&&n(null),r()}catch(o){n&&n(o),i(o)}}.bind(this))}},{key:"removeItem",value:function(e,t){return new Promise(function(n){this._syncImpl.removeItem(e),t&&t(null),n()}.bind(this))}},{key:"multiGet",value:function(e,t){return new Promise(function(n){for(var r=[],i=0;i<e.length;++i){var o=e[i],u=this._syncImpl.getItem(o);r.push({key:o,value:u})}t&&t(null,r),n(r)}.bind(this))}},{key:"multiSet",value:function(e,t){return new Promise(function(n,r){try{for(var i=0;i<e.length;++i){var o=e[i],u=o.key,s=o.value;this._syncImpl.setItem(u,s)}t&&t(null),n()}catch(a){t&&t(a),r(a)}}.bind(this))}},{key:"multiRemove",value:function(e,t){return new Promise(function(n){for(var r=0;r<e.length;++r){var i=e[r];this._syncImpl.removeItem(i)}t&&t(null),n()}.bind(this))}},{key:"key",value:function(e,t){return new Promise(function(n){var r=this._syncImpl.key(e);t&&t(null,r),n(r)}.bind(this))}},{key:"keys",value:function(e){return new Promise(function(t){for(var n=this._syncImpl.length,r=[],i=0;i<n;++i)r.push(this._syncImpl.key(i));e&&e(null,r),t(r)}.bind(this))}},{key:"length",value:function(e){return new Promise(function(t){var n=this._syncImpl.length;e&&e(null,n),t(n)}.bind(this))}}]),e}(),f=function(){function e(t,n){r(this,e),this._driver=t,this.keyWhiteList=n,this._purgeableKeys=[],this._driver.getItem(c).then(function(e){if(e)try{var t=JSON.parse(e),n=this._purgeableKeys;this._purgeableKeys=this._maintainLRUOrder(t,n)}catch(r){}}.bind(this))}return o(e,[{key:"_maintainLRUOrder",value:function(e,t){for(var n={},r=0;r<t.length;++r)n[t[r]]=!0;for(var i=t.slice(),o=0;o<e.length;++o)n[e[o]]||i.push(e[o]);return i}},{key:"_removeKeysInLRUOrder",value:function(e,t){for(var n={},r=0;r<t.length;++r)n[t[r]]=!0;for(var i=[],o=0;o<e.length;++o)n[e[o]]||i.push(e[o]);return i}},{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"getItem",value:function(e,t){return this._driver.getItem(e,t)}},{key:"setItem",value:function(e,t,n){return this.keyWhiteList&&this.keyWhiteList.indexOf(e)<0?Promise.reject(new Error("Saving key is not permitted")):this._driver.setItem(e,t).then(function(){return n&&n(null),Promise.resolve()},function(e){return this._purge().then(function(){return n&&n(e),Promise.reject(e)},function(){return n&&n(e),Promise.reject(e)})}.bind(this))}},{key:"setPurgeableItem",value:function(e,t,n){if(this.keyWhiteList&&this.keyWhiteList.indexOf(e)<0)return Promise.reject(new Error("Saving key is not permitted"));this._purgeableKeys=this._maintainLRUOrder(this._purgeableKeys,[e]);var r=[{key:e,value:t},{key:c,value:JSON.stringify(this._purgeableKeys)}];return this.multiSetTransactionally(r).then(function(){return n&&n(null),Promise.resolve()},function(e){return this._purge().then(function(){return n&&n(e),Promise.reject(e)},function(){return n&&n(e),Promise.reject(e)})}.bind(this))}},{key:"_selectKeysToPurge",value:function(e){var t=Math.floor(e.length/2),n=e.slice(t);return n}},{key:"_purge",value:function(){var e=this._selectKeysToPurge(this._purgeableKeys);return e.length<=0?Promise.reject(new Error("no more keys to purge")):(this._purgeableKeys=this._removeKeysInLRUOrder(this._purgeableKeys,e),this._driver.multiRemove(e).then(function(){return this._driver.setItem(c,JSON.stringify(this._purgeableKeys))}.bind(this)))}},{key:"multiSetTransactionally",value:function(e,t){for(var n=[],r=0;r<e.length;++r){var i=e[r],o=i.key;if(this.keyWhiteList&&this.keyWhiteList.indexOf(o)<0)return Promise.reject(new Error("Saving key is not permitted"));n.push(o)}return this._driver.multiGet(n).then(function(r){return this._driver.multiSet(e).then(function(){return t&&t(null),Promise.resolve()},function(e){return this._driver.multiRemove(n).then(function(){return this._driver.multiSet(r).then(function(){return t&&t(e),Promise.reject(e)})}.bind(this))}.bind(this))}.bind(this))}},{key:"clearPurgeableItems",value:function(e){var t=this._purgeableKeys.slice();return this._purgeableKeys=[],this._driver.multiRemove(t,e)}},{key:"removeItem",value:function(e,t){return this._driver.removeItem(e,t)}},{key:"key",value:function(e,t){return this._driver.key(e,t)}},{key:"keys",value:function(e){return this._driver.keys(e)}},{key:"length",value:function(e){return this._driver.length(e)}}]),e}();n.setStore=function(e){i=e};n["default"]=function(){if(i)return i;if("undefined"!=typeof window)if((0,s.isLocalStorageValid)())i=new f(new l(window.localStorage));else{var t=new u.CookieStorage;i=new f(new l(t,a))}else{var n=e("localstorage-memory");i=new f(new l(n))}return i}},{"./util":19,"cookie-storage":24,"localstorage-memory":42}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Sequence=function(){function e(){r(this,e)}return i(e,[{key:"toJSON",value:function(){return{$type:"seq"}}}]),e}(),n.UnknownValue=function(){function e(t){r(this,e),this.underlyingType=t}return i(e,[{key:"toJSON",value:function(){return{$type:"unknown",$underlying_type:this.underlyingType}}}],[{key:"fromJSON",value:function(t){return new e(t.$underlying_type)}}]),e}()},{}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r);
}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("lodash"),s=r(u),a=e("./role"),c=r(a),l=function(){function e(t){i(this,e);var n=t.user_id||t._id;if(!s["default"].isString(n))throw new Error("Missing user_id.");this.email=t.email,this.username=t.username,this.id=n,t.last_login_at&&(this.lastLoginAt=new Date(t.last_login_at)),t.last_seen_at&&(this.lastSeenAt=new Date(t.last_seen_at)),this.roles=[],t.roles&&(this.roles=s["default"].map(t.roles,c["default"].define))}return o(e,[{key:"toJSON",value:function(){var e={user_id:this.id,username:this.username,email:this.email,roles:s["default"].map(this.roles,function(e){return e.name})};return this.lastLoginAt&&(e.last_login_at=this.lastLoginAt.toJSON()),this.lastSeenAt&&(e.last_seen_at=this.lastSeenAt.toJSON()),e}},{key:"addRole",value:function(e){this.roles=c["default"].union(this.roles,e)}},{key:"removeRole",value:function(e){this.roles=c["default"].subtract(this.roles,e)}},{key:"hasRole",value:function(e){return c["default"].contain(this.roles,e)}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}();n["default"]=l,t.exports=n["default"]},{"./role":15,lodash:43}],19:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return null===e?null:l["default"].isArray(e)?l["default"].map(e,o):l["default"].isDate(e)?{$type:"date",$date:e.toJSON()}:e.toJSON?e.toJSON():l["default"].isObject(e)?l["default"].chain(e).map(function(e,t){return[t,o(e)]}).object().value():e}function u(e){if(!l["default"].isObject(e))return e;switch(e.$type){case"geo":return y["default"].fromJSON(e);case"asset":return h["default"].fromJSON(e);case"date":return new Date(e.$date);case"ref":return new d["default"](e);case"unknown":return _.UnknownValue.fromJSON(e);default:return e}}function s(){try{var e="_skygear_test";return window.localStorage.setItem(e,"test"),window.localStorage.removeItem(e),!0}catch(t){return!1}}Object.defineProperty(n,"__esModule",{value:!0}),n.EventHandle=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.toJSON=o,n.fromJSON=u,n.isLocalStorageValid=s;var c=e("lodash"),l=r(c),f=e("./asset"),h=r(f),p=e("./reference"),d=r(p),v=e("./geolocation"),y=r(v),_=e("./type");n.EventHandle=function(){function e(t,n,r){i(this,e),this.emitter=t,this.name=n,this.listener=r}return a(e,[{key:"cancel",value:function(){this.emitter.off(this.name,this.listener)}}]),e}()},{"./asset":2,"./geolocation":7,"./reference":13,"./type":17,lodash:43}],20:[function(e,t,n){!function(){function e(e){this.message=e}var t="undefined"!=typeof n?n:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var n,i,o=String(t),u=0,s=r,a="";o.charAt(0|u)||(s="=",u%1);a+=s.charAt(63&n>>8-u%1*8)){if(i=o.charCodeAt(u+=.75),i>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|i}return a}),t.atob||(t.atob=function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,o,u=0,s=0,a="";o=n.charAt(s++);~o&&(i=u%4?64*i+o:o,u++%4)?a+=String.fromCharCode(255&i>>(-2*u&6)):0)o=r.indexOf(o);return a})}()},{}],21:[function(e,t,n){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&c(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}function o(e){return a(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)}function u(e,t){return i(e,!1,!0).resolve(t)}function s(e,t){return e?i(e,!1,!0).resolveObject(t):t}function a(e){return"string"==typeof e}function c(e){return"object"==typeof e&&null!==e}function l(e){return null===e}function f(e){return null==e}var h=e("punycode");n.parse=i,n.resolve=u,n.resolveObject=s,n.format=o,n.Url=r;var p=/^([a-z0-9.+-]+:)/i,d=/:[0-9]*$/,v=["<",">",'"',"`"," ","\r","\n","\t"],y=["{","}","|","\\","^","`"].concat(v),_=["'"].concat(y),g=["%","/","?",";","#"].concat(_),m=["/","?","#"],b=255,w=/^[a-z0-9A-Z_-]{0,63}$/,k=/^([a-z0-9A-Z_-]{0,63})(.*)$/,O={javascript:!0,"javascript:":!0},R={javascript:!0,"javascript:":!0},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=e("querystring");r.prototype.parse=function(e,t,n){if(!a(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e;r=r.trim();var i=p.exec(r);if(i){i=i[0];var o=i.toLowerCase();this.protocol=o,r=r.substr(i.length)}if(n||i||r.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===r.substr(0,2);!u||i&&R[i]||(r=r.substr(2),this.slashes=!0)}if(!R[i]&&(u||i&&!x[i])){for(var s=-1,c=0;c<m.length;c++){var l=r.indexOf(m[c]);l!==-1&&(s===-1||l<s)&&(s=l)}var f,d;d=s===-1?r.lastIndexOf("@"):r.lastIndexOf("@",s),d!==-1&&(f=r.slice(0,d),r=r.slice(d+1),this.auth=decodeURIComponent(f)),s=-1;for(var c=0;c<g.length;c++){var l=r.indexOf(g[c]);l!==-1&&(s===-1||l<s)&&(s=l)}s===-1&&(s=r.length),this.host=r.slice(0,s),r=r.slice(s),this.parseHost(),this.hostname=this.hostname||"";var v="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!v)for(var y=this.hostname.split(/\./),c=0,j=y.length;c<j;c++){var E=y[c];if(E&&!E.match(w)){for(var T="",P=0,S=E.length;P<S;P++)T+=E.charCodeAt(P)>127?"x":E[P];if(!T.match(w)){var I=y.slice(0,c),C=y.slice(c+1),N=E.match(k);N&&(I.push(N[1]),C.unshift(N[2])),C.length&&(r="/"+C.join(".")+r),this.hostname=I.join(".");break}}}if(this.hostname.length>b?this.hostname="":this.hostname=this.hostname.toLowerCase(),!v){for(var q=this.hostname.split("."),D=[],c=0;c<q.length;++c){var U=q[c];D.push(U.match(/[^A-Za-z0-9_-]/)?"xn--"+h.encode(U):U)}this.hostname=D.join(".")}var $=this.port?":"+this.port:"",L=this.hostname||"";this.host=L+$,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==r[0]&&(r="/"+r))}if(!O[o])for(var c=0,j=_.length;c<j;c++){var F=_[c],W=encodeURIComponent(F);W===F&&(W=escape(F)),r=r.split(F).join(W)}var B=r.indexOf("#");B!==-1&&(this.hash=r.substr(B),r=r.slice(0,B));var M=r.indexOf("?");if(M!==-1?(this.search=r.substr(M),this.query=r.substr(M+1),t&&(this.query=A.parse(this.query)),r=r.slice(0,M)):t&&(this.search="",this.query={}),r&&(this.pathname=r),x[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var $=this.pathname||"",U=this.search||"";this.path=$+U}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&c(this.query)&&Object.keys(this.query).length&&(o=A.stringify(this.query));var u=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||x[t])&&i!==!1?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),u&&"?"!==u.charAt(0)&&(u="?"+u),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),u=u.replace("#","%23"),t+i+n+u+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(a(e)){var t=new r;t.parse(e,!1,!0),e=t}var n=new r;if(Object.keys(this).forEach(function(e){n[e]=this[e]},this),n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(t){"protocol"!==t&&(n[t]=e[t])}),x[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(e.protocol&&e.protocol!==n.protocol){if(!x[e.protocol])return Object.keys(e).forEach(function(t){n[t]=e[t]}),n.href=n.format(),n;if(n.protocol=e.protocol,e.host||R[e.protocol])n.pathname=e.pathname;else{for(var i=(e.pathname||"").split("/");i.length&&!(e.host=i.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==i[0]&&i.unshift(""),i.length<2&&i.unshift(""),n.pathname=i.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var o=n.pathname||"",u=n.search||"";n.path=o+u}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var s=n.pathname&&"/"===n.pathname.charAt(0),c=e.host||e.pathname&&"/"===e.pathname.charAt(0),h=c||s||n.host&&e.pathname,p=h,d=n.pathname&&n.pathname.split("/")||[],i=e.pathname&&e.pathname.split("/")||[],v=n.protocol&&!x[n.protocol];if(v&&(n.hostname="",n.port=null,n.host&&(""===d[0]?d[0]=n.host:d.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===i[0]?i[0]=e.host:i.unshift(e.host)),e.host=null),h=h&&(""===i[0]||""===d[0])),c)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,d=i;else if(i.length)d||(d=[]),d.pop(),d=d.concat(i),n.search=e.search,n.query=e.query;else if(!f(e.search)){if(v){n.hostname=n.host=d.shift();var y=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");y&&(n.auth=y.shift(),n.host=n.hostname=y.shift())}return n.search=e.search,n.query=e.query,l(n.pathname)&&l(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!d.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var _=d.slice(-1)[0],g=(n.host||e.host)&&("."===_||".."===_)||""===_,m=0,b=d.length;b>=0;b--)_=d[b],"."==_?d.splice(b,1):".."===_?(d.splice(b,1),m++):m&&(d.splice(b,1),m--);if(!h&&!p)for(;m--;m)d.unshift("..");!h||""===d[0]||d[0]&&"/"===d[0].charAt(0)||d.unshift(""),g&&"/"!==d.join("/").substr(-1)&&d.push("");var w=""===d[0]||d[0]&&"/"===d[0].charAt(0);if(v){n.hostname=n.host=w?"":d.length?d.shift():"";var y=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");y&&(n.auth=y.shift(),n.host=n.hostname=y.shift())}return h=h||n.host&&d.length,h&&!w&&d.unshift(""),d.length?n.pathname=d.join("/"):(n.pathname=null,n.path=null),l(n.pathname)&&l(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=d.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:45,querystring:48}],22:[function(e,t,n){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};t.exports=r},{}],23:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}"undefined"!=typeof t&&(t.exports=r),r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],24:[function(t,n,r){!function(t){"function"==typeof e&&e.amd?e(["exports"],t):"undefined"!=typeof r&&t(r)}(function(e){"use strict";var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var n,r=[],i=e[Symbol.iterator]();!(n=i.next()).done&&(r.push(n.value),!t||r.length!==t););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(t){var n=this;r(this,e),t=t||{},this._defaultOptions=this._extends({path:null,domain:null,expires:null,secure:!1},t),Object.defineProperty(this,"length",{get:function(){var e=n._parse(document.cookie);return Object.keys(e).length}})}return n(e,{clear:{value:function(){var e=this,t=this._parse(document.cookie);Object.keys(t).forEach(function(t){return e.removeItem(t)})}},getItem:{value:function(e){var t=this._parse(document.cookie);return t[e]}},key:{value:function(e){var t=this._parse(document.cookie);return Object.keys(t).sort()[e]}},removeItem:{value:function(e){var t="",n=this._clone(this._defaultOptions);n.expires=new Date(0);var r=this._format(e,t,n);document.cookie=r}},setItem:{value:function(e,t,n){n=n||{},n=this._extends(this._clone(this._defaultOptions),n);var r=this._format(e,t,n);document.cookie=r}},_clone:{value:function(e){var t={};return Object.keys(e).forEach(function(n){return t[n]=e[n]}),t}},_extends:{value:function(e,t){return Object.keys(t).forEach(function(n){return e[n]=t[n]}),e}},_format:{value:function(e,t,n){return[encodeURIComponent(e),"=",encodeURIComponent(t),this._formatOptions(n)].join("")}},_formatOptions:{value:function(e){return[this._isDefined(e.path)?";path="+e.path:"",this._isDefined(e.domain)?";domain="+e.domain:"",this._isDefined(e.expires)?";expires="+e.expires.toUTCString():"",this._isDefined(e.secure)&&e.secure?";secure":""].join("")}},_isDefined:{value:function(e){return"undefined"!=typeof e&&null!==e}},_parse:{value:function(e){if(!this._isDefined(e)||0===e.length)return{};var n={},r=new RegExp("\\s*;\\s*");return e.split(r).forEach(function(e){var r=e.split("="),i=t(r,2),o=i[0],u=i[1],s=decodeURIComponent(o),a=decodeURIComponent(u);n[s]=a}),n}}}),e}();e.CookieStorage=i})},{}],25:[function(e,t,n){!function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(t){for(var n=[],r=0;r<t.length;r+=3)for(var i=t[r]<<16|t[r+1]<<8|t[r+2],o=0;o<4;o++)8*r+6*o<=8*t.length?n.push(e.charAt(i>>>6*(3-o)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,i=0;r<t.length;i=++r%4)0!=i&&n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(t.charAt(r))>>>6-2*i);return n}};t.exports=n}()},{}],26:[function(e,t,n){"use strict";var r,i=e("es5-ext/object/assign"),o=e("es5-ext/object/normalize-options"),u=e("es5-ext/object/is-callable"),s=e("es5-ext/string/#/contains");r=t.exports=function(e,t){var n,r,u,a,c;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],null==e?(n=u=!0,r=!1):(n=s.call(e,"c"),r=s.call(e,"e"),u=s.call(e,"w")),c={value:t,configurable:n,enumerable:r,writable:u},a?i(o(a),c):c},r.gs=function(e,t,n){var r,a,c,l;return"string"!=typeof e?(c=n,n=t,t=e,e=null):c=arguments[3],null==t?t=void 0:u(t)?null==n?n=void 0:u(n)||(c=n,n=void 0):(c=t,t=n=void 0),null==e?(r=!0,a=!1):(r=s.call(e,"c"),a=s.call(e,"e")),l={get:t,set:n,configurable:r,enumerable:a},c?i(o(c),l):l}},{"es5-ext/object/assign":27,"es5-ext/object/is-callable":30,"es5-ext/object/normalize-options":34,"es5-ext/string/#/contains":37}],27:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(e,t,n){"use strict";t.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],29:[function(e,t,n){"use strict";var r=e("../keys"),i=e("../valid-value"),o=Math.max;t.exports=function(e,t){var n,u,s,a=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(i){n||(n=i)}},u=1;u<a;++u)t=arguments[u],r(t).forEach(s);if(void 0!==n)throw n;return e}},{"../keys":31,"../valid-value":36}],30:[function(e,t,n){"use strict";t.exports=function(e){return"function"==typeof e}},{}],31:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":32,"./shim":33}],32:[function(e,t,n){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],33:[function(e,t,n){"use strict";var r=Object.keys;t.exports=function(e){return r(null==e?e:Object(e))}},{}],34:[function(e,t,n){"use strict";var r=Array.prototype.forEach,i=Object.create,o=function(e,t){var n;for(n in e)t[n]=e[n]};t.exports=function(e){var t=i(null);return r.call(arguments,function(e){null!=e&&o(Object(e),t)}),t}},{}],35:[function(e,t,n){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],36:[function(e,t,n){"use strict";t.exports=function(e){if(null==e)throw new TypeError("Cannot use null or undefined");return e}},{}],37:[function(e,t,n){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":38,"./shim":39}],38:[function(e,t,n){"use strict";var r="razdwatrzy";t.exports=function(){return"function"==typeof r.contains&&(r.contains("dwa")===!0&&r.contains("foo")===!1)}},{}],39:[function(e,t,n){"use strict";var r=String.prototype.indexOf;t.exports=function(e){return r.call(this,e,arguments[1])>-1}},{}],40:[function(e,t,n){"use strict";var r,i,o,u,s,a,c,l=e("d"),f=e("es5-ext/object/valid-callable"),h=Function.prototype.apply,p=Function.prototype.call,d=Object.create,v=Object.defineProperty,y=Object.defineProperties,_=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};r=function(e,t){var n;return f(t),_.call(this,"__ee__")?n=this.__ee__:(n=g.value=d(null),v(this,"__ee__",g),g.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},i=function(e,t){var n,i;return f(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},o=function(e,t){var n,r,i,o;if(f(t),!_.call(this,"__ee__"))return this;if(n=this.__ee__,!n[e])return this;if(r=n[e],"object"==typeof r)for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},u=function(e){var t,n,r,i,o;if(_.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)h.call(r,this,o)}else switch(arguments.length){case 1:p.call(i,this);break;case 2:p.call(i,this,arguments[1]);break;case 3:p.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];h.call(i,this,o)}},s={on:r,once:i,off:o,emit:u},a={on:l(r),once:l(i),off:l(o),emit:l(u)},c=y({},a),t.exports=n=function(e){return null==e?d(c):y(Object(e),a)},n.methods=s},{d:26,"es5-ext/object/valid-callable":35}],41:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function i(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}t.exports=function(e){return null!=e&&(r(e)||i(e)||!!e._isBuffer)}},{}],42:[function(e,t,n){!function(e){var r={},i={};r.length=0,r.getItem=function(e){return i[e]||null},r.setItem=function(e,t){"undefined"==typeof t?r.removeItem(e):(i.hasOwnProperty(e)||r.length++,i[e]=""+t)},r.removeItem=function(e){i.hasOwnProperty(e)&&(delete i[e],r.length--)},r.key=function(e){return Object.keys(i)[e]||null},r.clear=function(){i={},r.length=0},"object"==typeof n?t.exports=r:e.localStorageMemory=r}(this)},{}],43:[function(t,n,r){(function(t){(function(){function i(e,t){if(e!==t){var n=null===e,r=e===A,i=e===e,o=null===t,u=t===A,s=t===t;if(e>t&&!o||!i||n&&!u&&s||r&&s)return 1;if(e<t&&!n||!s||o&&!r&&i||u&&i)return-1}return 0}function o(e,t,n){for(var r=e.length,i=n?r:-1;n?i--:++i<r;)if(t(e[i],i,e))return i;return-1}function u(e,t,n){if(t!==t)return _(e,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function s(e){return"function"==typeof e||!1}function a(e){return null==e?"":e+""}function c(e,t){for(var n=-1,r=e.length;++n<r&&t.indexOf(e.charAt(n))>-1;);return n}function l(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}function f(e,t){return i(e.criteria,t.criteria)||e.index-t.index}function h(e,t,n){for(var r=-1,o=e.criteria,u=t.criteria,s=o.length,a=n.length;++r<s;){var c=i(o[r],u[r]);if(c){if(r>=a)return c;var l=n[r];return c*("asc"===l||l===!0?1:-1)}}return e.index-t.index}function p(e){return Ke[e]}function d(e){return ze[e]}function v(e,t,n){return t?e=Xe[e]:n&&(e=Qe[e]),"\\"+e}function y(e){return"\\"+Qe[e]}function _(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}function g(e){return!!e&&"object"==typeof e}function m(e){return e<=160&&e>=9&&e<=13||32==e||160==e||5760==e||6158==e||e>=8192&&(e<=8202||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function b(e,t){for(var n=-1,r=e.length,i=-1,o=[];++n<r;)e[n]===t&&(e[n]=K,o[++i]=n);return o}function w(e,t){for(var n,r=-1,i=e.length,o=-1,u=[];++r<i;){var s=e[r],a=t?t(s,r,e):s;r&&n===a||(n=a,u[++o]=s)}return u}function k(e){for(var t=-1,n=e.length;++t<n&&m(e.charCodeAt(t)););return t}function O(e){for(var t=e.length;t--&&m(e.charCodeAt(t)););return t}function R(e){return He[e]}function x(e){function t(e){if(g(e)&&!Ts(e)&&!(e instanceof m)){if(e instanceof r)return e;if(tu.call(e,"__chain__")&&tu.call(e,"__wrapped__"))return pr(e)}return new r(e)}function n(){}function r(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function m(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Eu,this.__views__=[]}function Z(){var e=new m(this.__wrapped__);return e.__actions__=et(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=et(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=et(this.__views__),e}function ne(){if(this.__filtered__){var e=new m(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function ie(){var e=this.__wrapped__.value(),t=this.__dir__,n=Ts(e),r=t<0,i=n?e.length:0,o=zn(0,i,this.__views__),u=o.start,s=o.end,a=s-u,c=r?s:u-1,l=this.__iteratees__,f=l.length,h=0,p=Ou(a,this.__takeCount__);if(!n||i<W||i==a&&p==a)return nn(r&&n?e.reverse():e,this.__actions__);var d=[];e:for(;a--&&h<p;){c+=t;for(var v=-1,y=e[c];++v<f;){var _=l[v],g=_.iteratee,m=_.type,b=g(y);if(m==M)y=b;else if(!b){if(m==B)continue e;break e}}d[h++]=y}return d}function Ke(){this.__data__={}}function ze(e){return this.has(e)&&delete this.__data__[e]}function He(e){return"__proto__"==e?A:this.__data__[e]}function Ve(e){return"__proto__"!=e&&tu.call(this.__data__,e)}function Xe(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this}function Qe(e){var t=e?e.length:0;for(this.data={hash:_u(null),set:new fu};t--;)this.push(e[t])}function Ge(e,t){var n=e.data,r="string"==typeof t||Ni(t)?n.set.has(t):n.hash[t];return r?0:-1}function Ze(e){var t=this.data;"string"==typeof e||Ni(e)?t.set.add(e):t.hash[e]=!0}function Ye(e,t){for(var n=-1,r=e.length,i=-1,o=t.length,u=Wo(r+o);++n<r;)u[n]=e[n];for(;++i<o;)u[n++]=t[i];return u}function et(e,t){var n=-1,r=e.length;for(t||(t=Wo(r));++n<r;)t[n]=e[n];return t}function tt(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function nt(e,t){for(var n=e.length;n--&&t(e[n],n,e)!==!1;);return e}function ot(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function ut(e,t,n,r){for(var i=-1,o=e.length,u=r,s=u;++i<o;){var a=e[i],c=+t(a);n(c,u)&&(u=c,s=a)}return s}function st(e,t){for(var n=-1,r=e.length,i=-1,o=[];++n<r;){var u=e[n];t(u,n,e)&&(o[++i]=u)}return o}function at(e,t){for(var n=-1,r=e.length,i=Wo(r);++n<r;)i[n]=t(e[n],n,e);return i}function ct(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function lt(e,t,n,r){var i=-1,o=e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function ft(e,t,n,r){var i=e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function ht(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function pt(e,t){for(var n=e.length,r=0;n--;)r+=+t(e[n])||0;return r}function dt(e,t){return e===A?t:e}function vt(e,t,n,r){return e!==A&&tu.call(r,n)?e:t}function yt(e,t,n){for(var r=-1,i=Fs(t),o=i.length;++r<o;){var u=i[r],s=e[u],a=n(s,t[u],u,e,t);(a===a?a===s:s!==s)&&(s!==A||u in e)||(e[u]=a)}return e}function _t(e,t){return null==t?e:mt(t,Fs(t),e)}function gt(e,t){for(var n=-1,r=null==e,i=!r&&Gn(e),o=i?e.length:0,u=t.length,s=Wo(u);++n<u;){var a=t[n];i?s[n]=Zn(a,o)?e[a]:A:s[n]=r?A:e[a]}return s}function mt(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var o=t[r];n[o]=e[o]}return n}function bt(e,t,n){var r=typeof e;return"function"==r?t===A?e:un(e,t,n):null==e?Eo:"object"==r?Lt(e):t===A?No(e):Ft(e,t)}function wt(e,t,n,r,i,o,u){var s;if(n&&(s=i?n(e,r,i):n(e)),s!==A)return s;if(!Ni(e))return e;var a=Ts(e);if(a){if(s=Hn(e),!t)return et(e,s)}else{var c=ru.call(e),l=c==G;if(c!=ee&&c!=z&&(!l||i))return Je[c]?Xn(e,c,t):i?e:{};if(s=Vn(l?{}:e),!t)return _t(s,e)}o||(o=[]),u||(u=[]);for(var f=o.length;f--;)if(o[f]==e)return u[f];return o.push(e),u.push(s),(a?tt:St)(e,function(r,i){s[i]=wt(r,t,n,i,e,o,u)}),s}function kt(e,t,n){if("function"!=typeof e)throw new Qo(J);return hu(function(){e.apply(A,n)},t)}function Ot(e,t){var n=e?e.length:0,r=[];if(!n)return r;var i=-1,o=Mn(),s=o==u,a=s&&t.length>=W?vn(t):null,c=t.length;a&&(o=Ge,s=!1,t=a);e:for(;++i<n;){var l=e[i];if(s&&l===l){for(var f=c;f--;)if(t[f]===l)continue e;r.push(l)}else o(t,l,0)<0&&r.push(l)}return r}function Rt(e,t){var n=!0;return Du(e,function(e,r,i){return n=!!t(e,r,i)}),n}function xt(e,t,n,r){var i=r,o=i;return Du(e,function(e,u,s){var a=+t(e,u,s);(n(a,i)||a===r&&a===o)&&(i=a,o=e)}),o}function At(e,t,n,r){var i=e.length;for(n=null==n?0:+n||0,n<0&&(n=-n>i?0:i+n),r=r===A||r>i?i:+r||0,r<0&&(r+=i),i=n>r?0:r>>>0,n>>>=0;n<i;)e[n++]=t;return e}function jt(e,t){var n=[];return Du(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function Et(e,t,n,r){var i;return n(e,function(e,n,o){if(t(e,n,o))return i=r?n:e,!1}),i}function Tt(e,t,n,r){r||(r=[]);for(var i=-1,o=e.length;++i<o;){var u=e[i];g(u)&&Gn(u)&&(n||Ts(u)||xi(u))?t?Tt(u,t,n,r):ct(r,u):n||(r[r.length]=u)}return r}function Pt(e,t){return $u(e,t,eo)}function St(e,t){return $u(e,t,Fs)}function It(e,t){return Lu(e,t,Fs)}function Ct(e,t){for(var n=-1,r=t.length,i=-1,o=[];++n<r;){var u=t[n];Ci(e[u])&&(o[++i]=u)}return o}function Nt(e,t,n){if(null!=e){n!==A&&n in fr(e)&&(t=[n]);for(var r=0,i=t.length;null!=e&&r<i;)e=e[t[r++]];return r&&r==i?e:A}}function qt(e,t,n,r,i,o){return e===t||(null==e||null==t||!Ni(e)&&!g(t)?e!==e&&t!==t:Dt(e,t,qt,n,r,i,o))}function Dt(e,t,n,r,i,o,u){var s=Ts(e),a=Ts(t),c=H,l=H;s||(c=ru.call(e),c==z?c=ee:c!=ee&&(s=Mi(e))),a||(l=ru.call(t),l==z?l=ee:l!=ee&&(a=Mi(t)));var f=c==ee,h=l==ee,p=c==l;if(p&&!s&&!f)return Ln(e,t,c);if(!i){var d=f&&tu.call(e,"__wrapped__"),v=h&&tu.call(t,"__wrapped__");if(d||v)return n(d?e.value():e,v?t.value():t,r,i,o,u)}if(!p)return!1;o||(o=[]),u||(u=[]);for(var y=o.length;y--;)if(o[y]==e)return u[y]==t;o.push(e),u.push(t);var _=(s?$n:Fn)(e,t,n,r,i,o,u);return o.pop(),u.pop(),_}function Ut(e,t,n){var r=t.length,i=r,o=!n;if(null==e)return!i;for(e=fr(e);r--;){var u=t[r];if(o&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++r<i;){u=t[r];var s=u[0],a=e[s],c=u[1];if(o&&u[2]){if(a===A&&!(s in e))return!1}else{var l=n?n(a,c,s):A;if(!(l===A?qt(c,a,n,!0):l))return!1}}return!0}function $t(e,t){var n=-1,r=Gn(e)?Wo(e.length):[];return Du(e,function(e,i,o){r[++n]=t(e,i,o)}),r}function Lt(e){var t=Jn(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null!=e&&(e[n]===r&&(r!==A||n in fr(e)))}}return function(e){return Ut(e,t)}}function Ft(e,t){var n=Ts(e),r=er(e)&&rr(t),i=e+"";return e=hr(e),function(o){if(null==o)return!1;var u=i;if(o=fr(o),(n||!r)&&!(u in o)){if(o=1==e.length?o:Nt(o,Vt(e,0,-1)),null==o)return!1;u=Ar(e),o=fr(o)}return o[u]===t?t!==A||u in o:qt(t,o[u],A,!0)}}function Wt(e,t,n,r,i){if(!Ni(e))return e;var o=Gn(t)&&(Ts(t)||Mi(t)),u=o?A:Fs(t);return tt(u||t,function(s,a){if(u&&(a=s,s=t[a]),g(s))r||(r=[]),i||(i=[]),Bt(e,t,a,Wt,n,r,i);else{var c=e[a],l=n?n(c,s,a,e,t):A,f=l===A;f&&(l=s),l===A&&(!o||a in e)||!f&&(l===l?l===c:c!==c)||(e[a]=l)}}),e}function Bt(e,t,n,r,i,o,u){for(var s=o.length,a=t[n];s--;)if(o[s]==a)return void(e[n]=u[s]);var c=e[n],l=i?i(c,a,n,e,t):A,f=l===A;f&&(l=a,Gn(a)&&(Ts(a)||Mi(a))?l=Ts(c)?c:Gn(c)?et(c):[]:Fi(a)||xi(a)?l=xi(c)?Vi(c):Fi(c)?c:{}:f=!1),o.push(a),u.push(l),f?e[n]=r(l,a,i,o,u):(l===l?l!==c:c===c)&&(e[n]=l)}function Mt(e){return function(t){return null==t?A:t[e]}}function Jt(e){var t=e+"";return e=hr(e),function(n){return Nt(n,e,t)}}function Kt(e,t){for(var n=e?t.length:0;n--;){var r=t[n];if(r!=i&&Zn(r)){var i=r;pu.call(e,r,1)}}return e}function zt(e,t){return e+gu(Au()*(t-e+1))}function Ht(e,t,n,r,i){return i(e,function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)}),n}function Vt(e,t,n){var r=-1,i=e.length;t=null==t?0:+t||0,t<0&&(t=-t>i?0:i+t),n=n===A||n>i?i:+n||0,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Wo(i);++r<i;)o[r]=e[r+t];return o}function Xt(e,t){var n;return Du(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}function Qt(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function Gt(e,t,n){var r=Wn(),i=-1;t=at(t,function(e){return r(e)});var o=$t(e,function(e){var n=at(t,function(t){return t(e)});return{criteria:n,index:++i,value:e}});return Qt(o,function(e,t){return h(e,t,n)})}function Zt(e,t){var n=0;return Du(e,function(e,r,i){n+=+t(e,r,i)||0}),n}function Yt(e,t){var n=-1,r=Mn(),i=e.length,o=r==u,s=o&&i>=W,a=s?vn():null,c=[];a?(r=Ge,o=!1):(s=!1,a=t?[]:c);e:for(;++n<i;){var l=e[n],f=t?t(l,n,e):l;if(o&&l===l){for(var h=a.length;h--;)if(a[h]===f)continue e;t&&a.push(f),c.push(l)}else r(a,f,0)<0&&((t||s)&&a.push(f),c.push(l))}return c}function en(e,t){for(var n=-1,r=t.length,i=Wo(r);++n<r;)i[n]=e[t[n]];return i}function tn(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?Vt(e,r?0:o,r?o+1:i):Vt(e,r?o+1:0,r?i:o)}
function nn(e,t){var n=e;n instanceof m&&(n=n.value());for(var r=-1,i=t.length;++r<i;){var o=t[r];n=o.func.apply(o.thisArg,ct([n],o.args))}return n}function rn(e,t,n){var r=0,i=e?e.length:r;if("number"==typeof t&&t===t&&i<=Su){for(;r<i;){var o=r+i>>>1,u=e[o];(n?u<=t:u<t)&&null!==u?r=o+1:i=o}return i}return on(e,t,Eo,n)}function on(e,t,n,r){t=n(t);for(var i=0,o=e?e.length:0,u=t!==t,s=null===t,a=t===A;i<o;){var c=gu((i+o)/2),l=n(e[c]),f=l!==A,h=l===l;if(u)var p=h||r;else p=s?h&&f&&(r||null!=l):a?h&&(r||f):null!=l&&(r?l<=t:l<t);p?i=c+1:o=c}return Ou(o,Pu)}function un(e,t,n){if("function"!=typeof e)return Eo;if(t===A)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)};case 5:return function(n,r,i,o,u){return e.call(t,n,r,i,o,u)}}return function(){return e.apply(t,arguments)}}function sn(e){var t=new uu(e.byteLength),n=new du(t);return n.set(new du(e)),t}function an(e,t,n){for(var r=n.length,i=-1,o=ku(e.length-r,0),u=-1,s=t.length,a=Wo(s+o);++u<s;)a[u]=t[u];for(;++i<r;)a[n[i]]=e[i];for(;o--;)a[u++]=e[i++];return a}function cn(e,t,n){for(var r=-1,i=n.length,o=-1,u=ku(e.length-i,0),s=-1,a=t.length,c=Wo(u+a);++o<u;)c[o]=e[o];for(var l=o;++s<a;)c[l+s]=t[s];for(;++r<i;)c[l+n[r]]=e[o++];return c}function ln(e,t){return function(n,r,i){var o=t?t():{};if(r=Wn(r,i,3),Ts(n))for(var u=-1,s=n.length;++u<s;){var a=n[u];e(o,a,r(a,u,n),n)}else Du(n,function(t,n,i){e(o,t,r(t,n,i),i)});return o}}function fn(e){return _i(function(t,n){var r=-1,i=null==t?0:n.length,o=i>2?n[i-2]:A,u=i>2?n[2]:A,s=i>1?n[i-1]:A;for("function"==typeof o?(o=un(o,s,5),i-=2):(o="function"==typeof s?s:A,i-=o?1:0),u&&Yn(n[0],n[1],u)&&(o=i<3?A:o,i=1);++r<i;){var a=n[r];a&&e(t,a,o)}return t})}function hn(e,t){return function(n,r){var i=n?Bu(n):0;if(!nr(i))return e(n,r);for(var o=t?i:-1,u=fr(n);(t?o--:++o<i)&&r(u[o],o,u)!==!1;);return n}}function pn(e){return function(t,n,r){for(var i=fr(t),o=r(t),u=o.length,s=e?u:-1;e?s--:++s<u;){var a=o[s];if(n(i[a],a,i)===!1)break}return t}}function dn(e,t){function n(){var i=this&&this!==rt&&this instanceof n?r:e;return i.apply(t,arguments)}var r=_n(e);return n}function vn(e){return _u&&fu?new Qe(e):null}function yn(e){return function(t){for(var n=-1,r=xo(lo(t)),i=r.length,o="";++n<i;)o=e(o,r[n],n);return o}}function _n(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=qu(e.prototype),r=e.apply(n,t);return Ni(r)?r:n}}function gn(e){function t(n,r,i){i&&Yn(n,r,i)&&(r=A);var o=Un(n,e,A,A,A,A,A,r);return o.placeholder=t.placeholder,o}return t}function mn(e,t){return _i(function(n){var r=n[0];return null==r?r:(n.push(t),e.apply(A,n))})}function bn(e,t){return function(n,r,i){if(i&&Yn(n,r,i)&&(r=A),r=Wn(r,i,3),1==r.length){n=Ts(n)?n:lr(n);var o=ut(n,r,e,t);if(!n.length||o!==t)return o}return xt(n,r,e,t)}}function wn(e,t){return function(n,r,i){if(r=Wn(r,i,3),Ts(n)){var u=o(n,r,t);return u>-1?n[u]:A}return Et(n,r,e)}}function kn(e){return function(t,n,r){return t&&t.length?(n=Wn(n,r,3),o(t,n,e)):-1}}function On(e){return function(t,n,r){return n=Wn(n,r,3),Et(t,n,e,!0)}}function Rn(e){return function(){for(var t,n=arguments.length,i=e?n:-1,o=0,u=Wo(n);e?i--:++i<n;){var s=u[o++]=arguments[i];if("function"!=typeof s)throw new Qo(J);!t&&r.prototype.thru&&"wrapper"==Bn(s)&&(t=new r([],(!0)))}for(i=t?-1:n;++i<n;){s=u[i];var a=Bn(s),c="wrapper"==a?Wu(s):A;t=c&&tr(c[0])&&c[1]==(q|S|C|D)&&!c[4].length&&1==c[9]?t[Bn(c[0])].apply(t,c[3]):1==s.length&&tr(s)?t[a]():t.thru(s)}return function(){var e=arguments,r=e[0];if(t&&1==e.length&&Ts(r)&&r.length>=W)return t.plant(r).value();for(var i=0,o=n?u[i].apply(this,e):r;++i<n;)o=u[i].call(this,o);return o}}}function xn(e,t){return function(n,r,i){return"function"==typeof r&&i===A&&Ts(n)?e(n,r):t(n,un(r,i,3))}}function An(e){return function(t,n,r){return"function"==typeof n&&r===A||(n=un(n,r,3)),e(t,n,eo)}}function jn(e){return function(t,n,r){return"function"==typeof n&&r===A||(n=un(n,r,3)),e(t,n)}}function En(e){return function(t,n,r){var i={};return n=Wn(n,r,3),St(t,function(t,r,o){var u=n(t,r,o);r=e?u:r,t=e?t:u,i[r]=t}),i}}function Tn(e){return function(t,n,r){return t=a(t),(e?t:"")+Cn(t,n,r)+(e?"":t)}}function Pn(e){var t=_i(function(n,r){var i=b(r,t.placeholder);return Un(n,e,A,r,i)});return t}function Sn(e,t){return function(n,r,i,o){var u=arguments.length<3;return"function"==typeof r&&o===A&&Ts(n)?e(n,r,i,u):Ht(n,Wn(r,o,4),i,u,t)}}function In(e,t,n,r,i,o,u,s,a,c){function l(){for(var g=arguments.length,m=g,w=Wo(g);m--;)w[m]=arguments[m];if(r&&(w=an(w,r,i)),o&&(w=cn(w,o,u)),d||y){var k=l.placeholder,O=b(w,k);if(g-=O.length,g<c){var R=s?et(s):A,x=ku(c-g,0),j=d?O:A,P=d?A:O,S=d?w:A,I=d?A:w;t|=d?C:N,t&=~(d?N:C),v||(t&=~(E|T));var q=[e,t,n,S,j,I,P,R,a,x],D=In.apply(A,q);return tr(e)&&Mu(D,q),D.placeholder=k,D}}var U=h?n:this,$=p?U[e]:e;return s&&(w=ar(w,s)),f&&a<w.length&&(w.length=a),this&&this!==rt&&this instanceof l&&($=_||_n(e)),$.apply(U,w)}var f=t&q,h=t&E,p=t&T,d=t&S,v=t&P,y=t&I,_=p?A:_n(e);return l}function Cn(e,t,n){var r=e.length;if(t=+t,r>=t||!bu(t))return"";var i=t-r;return n=null==n?" ":n+"",_o(n,yu(i/n.length)).slice(0,i)}function Nn(e,t,n,r){function i(){for(var t=-1,s=arguments.length,a=-1,c=r.length,l=Wo(c+s);++a<c;)l[a]=r[a];for(;s--;)l[a++]=arguments[++t];var f=this&&this!==rt&&this instanceof i?u:e;return f.apply(o?n:this,l)}var o=t&E,u=_n(e);return i}function qn(e){var t=Ko[e];return function(e,n){return n=n===A?0:+n||0,n?(n=cu(10,n),t(e*n)/n):t(e)}}function Dn(e){return function(t,n,r,i){var o=Wn(r);return null==r&&o===bt?rn(t,n,e):on(t,n,o(r,i,1),e)}}function Un(e,t,n,r,i,o,u,s){var a=t&T;if(!a&&"function"!=typeof e)throw new Qo(J);var c=r?r.length:0;if(c||(t&=~(C|N),r=i=A),c-=i?i.length:0,t&N){var l=r,f=i;r=i=A}var h=a?A:Wu(e),p=[e,t,n,r,i,l,f,o,u,s];if(h&&(ir(p,h),t=p[1],s=p[9]),p[9]=null==s?a?0:e.length:ku(s-c,0)||0,t==E)var d=dn(p[0],p[2]);else d=t!=C&&t!=(E|C)||p[4].length?In.apply(A,p):Nn.apply(A,p);var v=h?Fu:Mu;return v(d,p)}function $n(e,t,n,r,i,o,u){var s=-1,a=e.length,c=t.length;if(a!=c&&!(i&&c>a))return!1;for(;++s<a;){var l=e[s],f=t[s],h=r?r(i?f:l,i?l:f,s):A;if(h!==A){if(h)continue;return!1}if(i){if(!ht(t,function(e){return l===e||n(l,e,r,i,o,u)}))return!1}else if(l!==f&&!n(l,f,r,i,o,u))return!1}return!0}function Ln(e,t,n){switch(n){case V:case X:return+e==+t;case Q:return e.name==t.name&&e.message==t.message;case Y:return e!=+e?t!=+t:e==+t;case te:case re:return e==t+""}return!1}function Fn(e,t,n,r,i,o,u){var s=Fs(e),a=s.length,c=Fs(t),l=c.length;if(a!=l&&!i)return!1;for(var f=a;f--;){var h=s[f];if(!(i?h in t:tu.call(t,h)))return!1}for(var p=i;++f<a;){h=s[f];var d=e[h],v=t[h],y=r?r(i?v:d,i?d:v,h):A;if(!(y===A?n(d,v,r,i,o,u):y))return!1;p||(p="constructor"==h)}if(!p){var _=e.constructor,g=t.constructor;if(_!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g))return!1}return!0}function Wn(e,n,r){var i=t.callback||Ao;return i=i===Ao?bt:i,r?i(e,n,r):i}function Bn(e){for(var t=e.name,n=Nu[t],r=n?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function Mn(e,n,r){var i=t.indexOf||Rr;return i=i===Rr?u:i,e?i(e,n,r):i}function Jn(e){for(var t=to(e),n=t.length;n--;)t[n][2]=rr(t[n][1]);return t}function Kn(e,t){var n=null==e?A:e[t];return Ui(n)?n:A}function zn(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],u=o.size;switch(o.type){case"drop":e+=u;break;case"dropRight":t-=u;break;case"take":t=Ou(t,e+u);break;case"takeRight":e=ku(e,t-u)}}return{start:e,end:t}}function Hn(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&tu.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Vn(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=Ho),new t}function Xn(e,t,n){var r=e.constructor;switch(t){case oe:return sn(e);case V:case X:return new r((+e));case ue:case se:case ae:case ce:case le:case fe:case he:case pe:case de:var i=e.buffer;return new r(n?sn(i):i,e.byteOffset,e.length);case Y:case re:return new r(e);case te:var o=new r(e.source,Ce.exec(e));o.lastIndex=e.lastIndex}return o}function Qn(e,t,n){null==e||er(t,e)||(t=hr(t),e=1==t.length?e:Nt(e,Vt(t,0,-1)),t=Ar(t));var r=null==e?e:e[t];return null==r?A:r.apply(e,n)}function Gn(e){return null!=e&&nr(Bu(e))}function Zn(e,t){return e="number"==typeof e||De.test(e)?+e:-1,t=null==t?Iu:t,e>-1&&e%1==0&&e<t}function Yn(e,t,n){if(!Ni(n))return!1;var r=typeof t;if("number"==r?Gn(n)&&Zn(t,n.length):"string"==r&&t in n){var i=n[t];return e===e?e===i:i!==i}return!1}function er(e,t){var n=typeof e;if("string"==n&&Ae.test(e)||"number"==n)return!0;if(Ts(e))return!1;var r=!xe.test(e);return r||null!=t&&e in fr(t)}function tr(e){var n=Bn(e);if(!(n in m.prototype))return!1;var r=t[n];if(e===r)return!0;var i=Wu(r);return!!i&&e===i[0]}function nr(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Iu}function rr(e){return e===e&&!Ni(e)}function ir(e,t){var n=e[1],r=t[1],i=n|r,o=i<q,u=r==q&&n==S||r==q&&n==D&&e[7].length<=t[8]||r==(q|D)&&n==S;if(!o&&!u)return e;r&E&&(e[2]=t[2],i|=n&E?0:P);var s=t[3];if(s){var a=e[3];e[3]=a?an(a,s,t[4]):et(s),e[4]=a?b(e[3],K):et(t[4])}return s=t[5],s&&(a=e[5],e[5]=a?cn(a,s,t[6]):et(s),e[6]=a?b(e[5],K):et(t[6])),s=t[7],s&&(e[7]=et(s)),r&q&&(e[8]=null==e[8]?t[8]:Ou(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i,e}function or(e,t){return e===A?t:Ps(e,t,or)}function ur(e,t){e=fr(e);for(var n=-1,r=t.length,i={};++n<r;){var o=t[n];o in e&&(i[o]=e[o])}return i}function sr(e,t){var n={};return Pt(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n}function ar(e,t){for(var n=e.length,r=Ou(t.length,n),i=et(e);r--;){var o=t[r];e[r]=Zn(o,n)?i[o]:A}return e}function cr(e){for(var t=eo(e),n=t.length,r=n&&e.length,i=!!r&&nr(r)&&(Ts(e)||xi(e)),o=-1,u=[];++o<n;){var s=t[o];(i&&Zn(s,r)||tu.call(e,s))&&u.push(s)}return u}function lr(e){return null==e?[]:Gn(e)?Ni(e)?e:Ho(e):oo(e)}function fr(e){return Ni(e)?e:Ho(e)}function hr(e){if(Ts(e))return e;var t=[];return a(e).replace(je,function(e,n,r,i){t.push(r?i.replace(Se,"$1"):n||e)}),t}function pr(e){return e instanceof m?e.clone():new r(e.__wrapped__,e.__chain__,et(e.__actions__))}function dr(e,t,n){t=(n?Yn(e,t,n):null==t)?1:ku(gu(t)||1,1);for(var r=0,i=e?e.length:0,o=-1,u=Wo(yu(i/t));r<i;)u[++o]=Vt(e,r,r+=t);return u}function vr(e){for(var t=-1,n=e?e.length:0,r=-1,i=[];++t<n;){var o=e[t];o&&(i[++r]=o)}return i}function yr(e,t,n){var r=e?e.length:0;return r?((n?Yn(e,t,n):null==t)&&(t=1),Vt(e,t<0?0:t)):[]}function _r(e,t,n){var r=e?e.length:0;return r?((n?Yn(e,t,n):null==t)&&(t=1),t=r-(+t||0),Vt(e,0,t<0?0:t)):[]}function gr(e,t,n){return e&&e.length?tn(e,Wn(t,n,3),!0,!0):[]}function mr(e,t,n){return e&&e.length?tn(e,Wn(t,n,3),!0):[]}function br(e,t,n,r){var i=e?e.length:0;return i?(n&&"number"!=typeof n&&Yn(e,t,n)&&(n=0,r=i),At(e,t,n,r)):[]}function wr(e){return e?e[0]:A}function kr(e,t,n){var r=e?e.length:0;return n&&Yn(e,t,n)&&(t=!1),r?Tt(e,t):[]}function Or(e){var t=e?e.length:0;return t?Tt(e,!0):[]}function Rr(e,t,n){var r=e?e.length:0;if(!r)return-1;if("number"==typeof n)n=n<0?ku(r+n,0):n;else if(n){var i=rn(e,t);return i<r&&(t===t?t===e[i]:e[i]!==e[i])?i:-1}return u(e,t,n||0)}function xr(e){return _r(e,1)}function Ar(e){var t=e?e.length:0;return t?e[t-1]:A}function jr(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if("number"==typeof n)i=(n<0?ku(r+n,0):Ou(n||0,r-1))+1;else if(n){i=rn(e,t,!0)-1;var o=e[i];return(t===t?t===o:o!==o)?i:-1}if(t!==t)return _(e,i,!0);for(;i--;)if(e[i]===t)return i;return-1}function Er(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var n=0,r=Mn(),i=e.length;++n<i;)for(var o=0,u=e[n];(o=r(t,u,o))>-1;)pu.call(t,o,1);return t}function Tr(e,t,n){var r=[];if(!e||!e.length)return r;var i=-1,o=[],u=e.length;for(t=Wn(t,n,3);++i<u;){var s=e[i];t(s,i,e)&&(r.push(s),o.push(i))}return Kt(e,o),r}function Pr(e){return yr(e,1)}function Sr(e,t,n){var r=e?e.length:0;return r?(n&&"number"!=typeof n&&Yn(e,t,n)&&(t=0,n=r),Vt(e,t,n)):[]}function Ir(e,t,n){var r=e?e.length:0;return r?((n?Yn(e,t,n):null==t)&&(t=1),Vt(e,0,t<0?0:t)):[]}function Cr(e,t,n){var r=e?e.length:0;return r?((n?Yn(e,t,n):null==t)&&(t=1),t=r-(+t||0),Vt(e,t<0?0:t)):[]}function Nr(e,t,n){return e&&e.length?tn(e,Wn(t,n,3),!1,!0):[]}function qr(e,t,n){return e&&e.length?tn(e,Wn(t,n,3)):[]}function Dr(e,t,n,r){var i=e?e.length:0;if(!i)return[];null!=t&&"boolean"!=typeof t&&(r=n,n=Yn(e,t,r)?A:t,t=!1);var o=Wn();return null==n&&o===bt||(n=o(n,r,3)),t&&Mn()==u?w(e,n):Yt(e,n)}function Ur(e){if(!e||!e.length)return[];var t=-1,n=0;e=st(e,function(e){if(Gn(e))return n=ku(e.length,n),!0});for(var r=Wo(n);++t<n;)r[t]=at(e,Mt(t));return r}function $r(e,t,n){var r=e?e.length:0;if(!r)return[];var i=Ur(e);return null==t?i:(t=un(t,n,4),at(i,function(e){return lt(e,t,A,!0)}))}function Lr(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Gn(n))var r=r?ct(Ot(r,n),Ot(n,r)):n}return r?Yt(r):[]}function Fr(e,t){var n=-1,r=e?e.length:0,i={};for(!r||t||Ts(e[0])||(t=[]);++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function Wr(e){var n=t(e);return n.__chain__=!0,n}function Br(e,t,n){return t.call(n,e),e}function Mr(e,t,n){return t.call(n,e)}function Jr(){return Wr(this)}function Kr(){return new r(this.value(),this.__chain__)}function zr(e){for(var t,r=this;r instanceof n;){var i=pr(r);t?o.__wrapped__=i:t=i;var o=i;r=r.__wrapped__}return o.__wrapped__=e,t}function Hr(){var e=this.__wrapped__,t=function(e){return n&&n.__dir__<0?e:e.reverse()};if(e instanceof m){var n=e;return this.__actions__.length&&(n=new m(this)),n=n.reverse(),n.__actions__.push({func:Mr,args:[t],thisArg:A}),new r(n,this.__chain__)}return this.thru(t)}function Vr(){return this.value()+""}function Xr(){return nn(this.__wrapped__,this.__actions__)}function Qr(e,t,n){var r=Ts(e)?ot:Rt;return n&&Yn(e,t,n)&&(t=A),"function"==typeof t&&n===A||(t=Wn(t,n,3)),r(e,t)}function Gr(e,t,n){var r=Ts(e)?st:jt;return t=Wn(t,n,3),r(e,t)}function Zr(e,t){return is(e,Lt(t))}function Yr(e,t,n,r){var i=e?Bu(e):0;return nr(i)||(e=oo(e),i=e.length),n="number"!=typeof n||r&&Yn(t,n,r)?0:n<0?ku(i+n,0):n||0,"string"==typeof e||!Ts(e)&&Bi(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Mn(e,t,n)>-1}function ei(e,t,n){var r=Ts(e)?at:$t;return t=Wn(t,n,3),r(e,t)}function ti(e,t){return ei(e,No(t))}function ni(e,t,n){var r=Ts(e)?st:jt;return t=Wn(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})}function ri(e,t,n){if(n?Yn(e,t,n):null==t){e=lr(e);var r=e.length;return r>0?e[zt(0,r-1)]:A}var i=-1,o=Hi(e),r=o.length,u=r-1;for(t=Ou(t<0?0:+t||0,r);++i<t;){var s=zt(i,u),a=o[s];o[s]=o[i],o[i]=a}return o.length=t,o}function ii(e){return ri(e,Eu)}function oi(e){var t=e?Bu(e):0;return nr(t)?t:Fs(e).length}function ui(e,t,n){var r=Ts(e)?ht:Xt;return n&&Yn(e,t,n)&&(t=A),"function"==typeof t&&n===A||(t=Wn(t,n,3)),r(e,t)}function si(e,t,n){if(null==e)return[];n&&Yn(e,t,n)&&(t=A);var r=-1;t=Wn(t,n,3);var i=$t(e,function(e,n,i){return{criteria:t(e,n,i),index:++r,value:e}});return Qt(i,f)}function ai(e,t,n,r){return null==e?[]:(r&&Yn(t,n,r)&&(n=A),Ts(t)||(t=null==t?[]:[t]),Ts(n)||(n=null==n?[]:[n]),Gt(e,t,n))}function ci(e,t){return Gr(e,Lt(t))}function li(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Qo(J);var n=e;e=t,t=n}return e=bu(e=+e)?e:0,function(){if(--e<1)return t.apply(this,arguments)}}function fi(e,t,n){return n&&Yn(e,t,n)&&(t=A),t=e&&null==t?e.length:ku(+t||0,0),Un(e,q,A,A,A,A,t)}function hi(e,t){var n;if("function"!=typeof t){if("function"!=typeof e)throw new Qo(J);var r=e;e=t,t=r}return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=A),n}}function pi(e,t,n){function r(){p&&su(p),c&&su(c),v=0,c=p=d=A}function i(t,n){n&&su(n),c=p=d=A,t&&(v=vs(),l=e.apply(h,a),p||c||(a=h=A))}function o(){var e=t-(vs()-f);e<=0||e>t?i(d,c):p=hu(o,e)}function u(){i(_,p)}function s(){if(a=arguments,f=vs(),h=this,d=_&&(p||!g),y===!1)var n=g&&!p;else{c||g||(v=f);var r=y-(f-v),i=r<=0||r>y;i?(c&&(c=su(c)),v=f,l=e.apply(h,a)):c||(c=hu(u,r))}return i&&p?p=su(p):p||t===y||(p=hu(o,t)),n&&(i=!0,l=e.apply(h,a)),!i||p||c||(a=h=A),l}var a,c,l,f,h,p,d,v=0,y=!1,_=!0;if("function"!=typeof e)throw new Qo(J);if(t=t<0?0:+t||0,n===!0){var g=!0;_=!1}else Ni(n)&&(g=!!n.leading,y="maxWait"in n&&ku(+n.maxWait||0,t),_="trailing"in n?!!n.trailing:_);return s.cancel=r,s}function di(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Qo(J);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var u=e.apply(this,r);return n.cache=o.set(i,u),u};return n.cache=new di.Cache,n}function vi(e){if("function"!=typeof e)throw new Qo(J);return function(){return!e.apply(this,arguments)}}function yi(e){return hi(2,e)}function _i(e,t){if("function"!=typeof e)throw new Qo(J);return t=ku(t===A?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,i=ku(n.length-t,0),o=Wo(i);++r<i;)o[r]=n[t+r];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,n[0],o);case 2:return e.call(this,n[0],n[1],o)}var u=Wo(t+1);for(r=-1;++r<t;)u[r]=n[r];return u[t]=o,e.apply(this,u)}}function gi(e){if("function"!=typeof e)throw new Qo(J);return function(t){return e.apply(this,t)}}function mi(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Qo(J);return n===!1?r=!1:Ni(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),pi(e,t,{leading:r,maxWait:+t,trailing:i})}function bi(e,t){return t=null==t?Eo:t,Un(t,C,A,[e],[])}function wi(e,t,n,r){return t&&"boolean"!=typeof t&&Yn(e,t,n)?t=!1:"function"==typeof t&&(r=n,n=t,t=!1),"function"==typeof n?wt(e,t,un(n,r,1)):wt(e,t)}function ki(e,t,n){return"function"==typeof t?wt(e,!0,un(t,n,1)):wt(e,!0)}function Oi(e,t){return e>t}function Ri(e,t){return e>=t}function xi(e){return g(e)&&Gn(e)&&tu.call(e,"callee")&&!lu.call(e,"callee")}function Ai(e){return e===!0||e===!1||g(e)&&ru.call(e)==V}function ji(e){return g(e)&&ru.call(e)==X}function Ei(e){return!!e&&1===e.nodeType&&g(e)&&!Fi(e)}function Ti(e){return null==e||(Gn(e)&&(Ts(e)||Bi(e)||xi(e)||g(e)&&Ci(e.splice))?!e.length:!Fs(e).length)}function Pi(e,t,n,r){n="function"==typeof n?un(n,r,3):A;var i=n?n(e,t):A;return i===A?qt(e,t,n):!!i}function Si(e){return g(e)&&"string"==typeof e.message&&ru.call(e)==Q}function Ii(e){return"number"==typeof e&&bu(e)}function Ci(e){return Ni(e)&&ru.call(e)==G}function Ni(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function qi(e,t,n,r){return n="function"==typeof n?un(n,r,3):A,Ut(e,Jn(t),n)}function Di(e){return Li(e)&&e!=+e}function Ui(e){return null!=e&&(Ci(e)?ou.test(eu.call(e)):g(e)&&qe.test(e))}function $i(e){return null===e}function Li(e){return"number"==typeof e||g(e)&&ru.call(e)==Y}function Fi(e){var t;if(!g(e)||ru.call(e)!=ee||xi(e)||!tu.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var n;return Pt(e,function(e,t){n=t}),n===A||tu.call(e,n)}function Wi(e){return Ni(e)&&ru.call(e)==te}function Bi(e){return"string"==typeof e||g(e)&&ru.call(e)==re}function Mi(e){return g(e)&&nr(e.length)&&!!Me[ru.call(e)]}function Ji(e){return e===A}function Ki(e,t){return e<t}function zi(e,t){return e<=t}function Hi(e){var t=e?Bu(e):0;return nr(t)?t?et(e):[]:oo(e)}function Vi(e){return mt(e,eo(e))}function Xi(e,t,n){var r=qu(e);return n&&Yn(e,t,n)&&(t=A),t?_t(r,t):r}function Qi(e){return Ct(e,eo(e))}function Gi(e,t,n){var r=null==e?A:Nt(e,hr(t),t+"");return r===A?n:r}function Zi(e,t){if(null==e)return!1;var n=tu.call(e,t);if(!n&&!er(t)){if(t=hr(t),e=1==t.length?e:Nt(e,Vt(t,0,-1)),null==e)return!1;t=Ar(t),n=tu.call(e,t)}return n||nr(e.length)&&Zn(t,e.length)&&(Ts(e)||xi(e))}function Yi(e,t,n){n&&Yn(e,t,n)&&(t=A);for(var r=-1,i=Fs(e),o=i.length,u={};++r<o;){var s=i[r],a=e[s];t?tu.call(u,a)?u[a].push(s):u[a]=[s]:u[a]=s}return u}function eo(e){if(null==e)return[];Ni(e)||(e=Ho(e));var t=e.length;t=t&&nr(t)&&(Ts(e)||xi(e))&&t||0;for(var n=e.constructor,r=-1,i="function"==typeof n&&n.prototype===e,o=Wo(t),u=t>0;++r<t;)o[r]=r+"";for(var s in e)u&&Zn(s,t)||"constructor"==s&&(i||!tu.call(e,s))||o.push(s);return o}function to(e){e=fr(e);for(var t=-1,n=Fs(e),r=n.length,i=Wo(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i}function no(e,t,n){var r=null==e?A:e[t];return r===A&&(null==e||er(t,e)||(t=hr(t),e=1==t.length?e:Nt(e,Vt(t,0,-1)),r=null==e?A:e[Ar(t)]),r=r===A?n:r),Ci(r)?r.call(e):r}function ro(e,t,n){if(null==e)return e;var r=t+"";t=null!=e[r]||er(t,e)?[r]:hr(t);for(var i=-1,o=t.length,u=o-1,s=e;null!=s&&++i<o;){var a=t[i];Ni(s)&&(i==u?s[a]=n:null==s[a]&&(s[a]=Zn(t[i+1])?[]:{})),s=s[a]}return e}function io(e,t,n,r){var i=Ts(e)||Mi(e);if(t=Wn(t,r,4),null==n)if(i||Ni(e)){var o=e.constructor;n=i?Ts(e)?new o:[]:qu(Ci(o)?o.prototype:A)}else n={};return(i?tt:St)(e,function(e,r,i){return t(n,e,r,i)}),n}function oo(e){return en(e,Fs(e))}function uo(e){return en(e,eo(e))}function so(e,t,n){return t=+t||0,n===A?(n=t,t=0):n=+n||0,e>=Ou(t,n)&&e<ku(t,n)}function ao(e,t,n){n&&Yn(e,t,n)&&(t=n=A);var r=null==e,i=null==t;if(null==n&&(i&&"boolean"==typeof e?(n=e,e=1):"boolean"==typeof t&&(n=t,i=!0)),r&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1){var o=Au();return Ou(e+o*(t-e+au("1e-"+((o+"").length-1))),t)}return zt(e,t)}function co(e){return e=a(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function lo(e){return e=a(e),e&&e.replace(Ue,p).replace(Pe,"")}function fo(e,t,n){e=a(e),t+="";var r=e.length;return n=n===A?r:Ou(n<0?0:+n||0,r),n-=t.length,n>=0&&e.indexOf(t,n)==n}function ho(e){return e=a(e),e&&we.test(e)?e.replace(me,d):e}function po(e){return e=a(e),e&&Te.test(e)?e.replace(Ee,v):e||"(?:)"}function vo(e,t,n){e=a(e),t=+t;var r=e.length;if(r>=t||!bu(t))return e;var i=(t-r)/2,o=gu(i),u=yu(i);return n=Cn("",u,n),n.slice(0,o)+e+n}function yo(e,t,n){return(n?Yn(e,t,n):null==t)?t=0:t&&(t=+t),e=bo(e),xu(e,t||(Ne.test(e)?16:10))}function _o(e,t){var n="";if(e=a(e),t=+t,t<1||!e||!bu(t))return n;do t%2&&(n+=e),t=gu(t/2),e+=e;while(t);return n}function go(e,t,n){return e=a(e),n=null==n?0:Ou(n<0?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function mo(e,n,r){var i=t.templateSettings;r&&Yn(e,n,r)&&(n=r=A),e=a(e),n=yt(_t({},r||n),i,vt);var o,u,s=yt(_t({},n.imports),i.imports,vt),c=Fs(s),l=en(s,c),f=0,h=n.interpolate||$e,p="__p += '",d=Vo((n.escape||$e).source+"|"+h.source+"|"+(h===Re?Ie:$e).source+"|"+(n.evaluate||$e).source+"|$","g"),v="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++Be+"]")+"\n";e.replace(d,function(t,n,r,i,s,a){return r||(r=i),p+=e.slice(f,a).replace(Le,y),n&&(o=!0,p+="' +\n__e("+n+") +\n'"),s&&(u=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),f=a+t.length,t}),p+="';\n";var _=n.variable;_||(p="with (obj) {\n"+p+"\n}\n"),p=(u?p.replace(ve,""):p).replace(ye,"$1").replace(_e,"$1;"),p="function("+(_||"obj")+") {\n"+(_?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(u?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Gs(function(){return Jo(c,v+"return "+p).apply(A,l)});if(g.source=p,Si(g))throw g;return g}function bo(e,t,n){var r=e;return(e=a(e))?(n?Yn(r,t,n):null==t)?e.slice(k(e),O(e)+1):(t+="",e.slice(c(e,t),l(e,t)+1)):e}function wo(e,t,n){var r=e;return e=a(e),e?(n?Yn(r,t,n):null==t)?e.slice(k(e)):e.slice(c(e,t+"")):e}function ko(e,t,n){var r=e;return e=a(e),e?(n?Yn(r,t,n):null==t)?e.slice(0,O(e)+1):e.slice(0,l(e,t+"")+1):e}function Oo(e,t,n){n&&Yn(e,t,n)&&(t=A);var r=U,i=$;if(null!=t)if(Ni(t)){var o="separator"in t?t.separator:o;r="length"in t?+t.length||0:r,i="omission"in t?a(t.omission):i}else r=+t||0;if(e=a(e),r>=e.length)return e;var u=r-i.length;if(u<1)return i;var s=e.slice(0,u);if(null==o)return s+i;if(Wi(o)){if(e.slice(u).search(o)){var c,l,f=e.slice(0,u);for(o.global||(o=Vo(o.source,(Ce.exec(o)||"")+"g")),o.lastIndex=0;c=o.exec(f);)l=c.index;s=s.slice(0,null==l?u:l)}}else if(e.indexOf(o,u)!=u){var h=s.lastIndexOf(o);h>-1&&(s=s.slice(0,h))}return s+i}function Ro(e){return e=a(e),e&&be.test(e)?e.replace(ge,R):e}function xo(e,t,n){return n&&Yn(e,t,n)&&(t=A),e=a(e),e.match(t||Fe)||[]}function Ao(e,t,n){return n&&Yn(e,t,n)&&(t=A),g(e)?To(e):bt(e,t)}function jo(e){return function(){return e}}function Eo(e){return e}function To(e){return Lt(wt(e,!0))}function Po(e,t){return Ft(e,wt(t,!0))}function So(e,t,n){if(null==n){var r=Ni(t),i=r?Fs(t):A,o=i&&i.length?Ct(t,i):A;(o?o.length:r)||(o=!1,n=t,t=e,e=this)}o||(o=Ct(t,Fs(t)));var u=!0,s=-1,a=Ci(e),c=o.length;n===!1?u=!1:Ni(n)&&"chain"in n&&(u=n.chain);for(;++s<c;){var l=o[s],f=t[l];e[l]=f,a&&(e.prototype[l]=function(t){return function(){var n=this.__chain__;if(u||n){var r=e(this.__wrapped__),i=r.__actions__=et(this.__actions__);return i.push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}return t.apply(e,ct([this.value()],arguments))}}(f))}return e}function Io(){return rt._=iu,this}function Co(){}function No(e){return er(e)?Mt(e):Jt(e)}function qo(e){return function(t){return Nt(e,hr(t),t+"")}}function Do(e,t,n){n&&Yn(e,t,n)&&(t=n=A),e=+e||0,n=null==n?1:+n||0,null==t?(t=e,e=0):t=+t||0;for(var r=-1,i=ku(yu((t-e)/(n||1)),0),o=Wo(i);++r<i;)o[r]=e,e+=n;return o}function Uo(e,t,n){if(e=gu(e),e<1||!bu(e))return[];var r=-1,i=Wo(Ou(e,Tu));for(t=un(t,n,1);++r<e;)r<Tu?i[r]=t(r):t(r);return i}function $o(e){var t=++nu;return a(e)+t}function Lo(e,t){return(+e||0)+(+t||0)}function Fo(e,t,n){return n&&Yn(e,t,n)&&(t=A),t=Wn(t,n,3),1==t.length?pt(Ts(e)?e:lr(e),t):Zt(e,t)}e=e?it.defaults(rt.Object(),e,it.pick(rt,We)):rt;var Wo=e.Array,Bo=e.Date,Mo=e.Error,Jo=e.Function,Ko=e.Math,zo=e.Number,Ho=e.Object,Vo=e.RegExp,Xo=e.String,Qo=e.TypeError,Go=Wo.prototype,Zo=Ho.prototype,Yo=Xo.prototype,eu=Jo.prototype.toString,tu=Zo.hasOwnProperty,nu=0,ru=Zo.toString,iu=rt._,ou=Vo("^"+eu.call(tu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),uu=e.ArrayBuffer,su=e.clearTimeout,au=e.parseFloat,cu=Ko.pow,lu=Zo.propertyIsEnumerable,fu=Kn(e,"Set"),hu=e.setTimeout,pu=Go.splice,du=e.Uint8Array,vu=Kn(e,"WeakMap"),yu=Ko.ceil,_u=Kn(Ho,"create"),gu=Ko.floor,mu=Kn(Wo,"isArray"),bu=e.isFinite,wu=Kn(Ho,"keys"),ku=Ko.max,Ou=Ko.min,Ru=Kn(Bo,"now"),xu=e.parseInt,Au=Ko.random,ju=zo.NEGATIVE_INFINITY,Eu=zo.POSITIVE_INFINITY,Tu=4294967295,Pu=Tu-1,Su=Tu>>>1,Iu=9007199254740991,Cu=vu&&new vu,Nu={};t.support={};t.templateSettings={escape:ke,evaluate:Oe,interpolate:Re,variable:"",imports:{_:t}};var qu=function(){function e(){}return function(t){if(Ni(t)){e.prototype=t;var n=new e;e.prototype=A}return n||{}}}(),Du=hn(St),Uu=hn(It,!0),$u=pn(),Lu=pn(!0),Fu=Cu?function(e,t){return Cu.set(e,t),e}:Eo,Wu=Cu?function(e){return Cu.get(e)}:Co,Bu=Mt("length"),Mu=function(){var e=0,t=0;return function(n,r){var i=vs(),o=F-(i-t);if(t=i,o>0){if(++e>=L)return n}else e=0;return Fu(n,r)}}(),Ju=_i(function(e,t){return g(e)&&Gn(e)?Ot(e,Tt(t,!1,!0)):[]}),Ku=kn(),zu=kn(!0),Hu=_i(function(e){for(var t=e.length,n=t,r=Wo(f),i=Mn(),o=i==u,s=[];n--;){var a=e[n]=Gn(a=e[n])?a:[];r[n]=o&&a.length>=120?vn(n&&a):null}var c=e[0],l=-1,f=c?c.length:0,h=r[0];e:for(;++l<f;)if(a=c[l],(h?Ge(h,a):i(s,a,0))<0){for(var n=t;--n;){var p=r[n];if((p?Ge(p,a):i(e[n],a,0))<0)continue e}h&&h.push(a),s.push(a)}return s}),Vu=_i(function(e,t){t=Tt(t);var n=gt(e,t);return Kt(e,t.sort(i)),n}),Xu=Dn(),Qu=Dn(!0),Gu=_i(function(e){return Yt(Tt(e,!1,!0))}),Zu=_i(function(e,t){return Gn(e)?Ot(e,t):[]}),Yu=_i(Ur),es=_i(function(e){var t=e.length,n=t>2?e[t-2]:A,r=t>1?e[t-1]:A;return t>2&&"function"==typeof n?t-=2:(n=t>1&&"function"==typeof r?(--t,r):A,r=A),e.length=t,$r(e,n,r)}),ts=_i(function(e){return e=Tt(e),this.thru(function(t){return Ye(Ts(t)?t:[fr(t)],e)})}),ns=_i(function(e,t){return gt(e,Tt(t))}),rs=ln(function(e,t,n){tu.call(e,n)?++e[n]:e[n]=1}),is=wn(Du),os=wn(Uu,!0),us=xn(tt,Du),ss=xn(nt,Uu),as=ln(function(e,t,n){tu.call(e,n)?e[n].push(t):e[n]=[t]}),cs=ln(function(e,t,n){e[n]=t}),ls=_i(function(e,t,n){var r=-1,i="function"==typeof t,o=er(t),u=Gn(e)?Wo(e.length):[];return Du(e,function(e){var s=i?t:o&&null!=e?e[t]:A;u[++r]=s?s.apply(e,n):Qn(e,t,n)}),u}),fs=ln(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),hs=Sn(lt,Du),ps=Sn(ft,Uu),ds=_i(function(e,t){if(null==e)return[];var n=t[2];return n&&Yn(t[0],t[1],n)&&(t.length=1),Gt(e,Tt(t),[])}),vs=Ru||function(){return(new Bo).getTime()},ys=_i(function(e,t,n){var r=E;if(n.length){var i=b(n,ys.placeholder);r|=C}return Un(e,r,t,n,i)}),_s=_i(function(e,t){t=t.length?Tt(t):Qi(e);for(var n=-1,r=t.length;++n<r;){var i=t[n];e[i]=Un(e[i],E,e)}return e}),gs=_i(function(e,t,n){var r=E|T;if(n.length){var i=b(n,gs.placeholder);r|=C}return Un(t,r,e,n,i)}),ms=gn(S),bs=gn(I),ws=_i(function(e,t){return kt(e,1,t)}),ks=_i(function(e,t,n){return kt(e,t,n)}),Os=Rn(),Rs=Rn(!0),xs=_i(function(e,t){if(t=Tt(t),"function"!=typeof e||!ot(t,s))throw new Qo(J);var n=t.length;return _i(function(r){for(var i=Ou(r.length,n);i--;)r[i]=t[i](r[i]);return e.apply(this,r)})}),As=Pn(C),js=Pn(N),Es=_i(function(e,t){return Un(e,D,A,A,A,Tt(t))}),Ts=mu||function(e){return g(e)&&nr(e.length)&&ru.call(e)==H},Ps=fn(Wt),Ss=fn(function(e,t,n){return n?yt(e,t,n):_t(e,t)}),Is=mn(Ss,dt),Cs=mn(Ps,or),Ns=On(St),qs=On(It),Ds=An($u),Us=An(Lu),$s=jn(St),Ls=jn(It),Fs=wu?function(e){var t=null==e?A:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&Gn(e)?cr(e):Ni(e)?wu(e):[]}:cr,Ws=En(!0),Bs=En(),Ms=_i(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=at(Tt(t),Xo);return ur(e,Ot(eo(e),t))}var n=un(t[0],t[1],3);return sr(e,function(e,t,r){return!n(e,t,r)})}),Js=_i(function(e,t){return null==e?{}:"function"==typeof t[0]?sr(e,un(t[0],t[1],3)):ur(e,Tt(t))}),Ks=yn(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),zs=yn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Hs=Tn(),Vs=Tn(!0),Xs=yn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Qs=yn(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Gs=_i(function(e,t){try{return e.apply(A,t)}catch(n){return Si(n)?n:new Mo(n)}}),Zs=_i(function(e,t){return function(n){return Qn(n,e,t)}}),Ys=_i(function(e,t){return function(n){return Qn(e,n,t)}}),ea=qn("ceil"),ta=qn("floor"),na=bn(Oi,ju),ra=bn(Ki,Eu),ia=qn("round");return t.prototype=n.prototype,r.prototype=qu(n.prototype),r.prototype.constructor=r,m.prototype=qu(n.prototype),m.prototype.constructor=m,Ke.prototype["delete"]=ze,Ke.prototype.get=He,Ke.prototype.has=Ve,Ke.prototype.set=Xe,Qe.prototype.push=Ze,di.Cache=Ke,t.after=li,t.ary=fi,t.assign=Ss,t.at=ns,t.before=hi,t.bind=ys,t.bindAll=_s,t.bindKey=gs,t.callback=Ao,t.chain=Wr,t.chunk=dr,t.compact=vr,t.constant=jo,t.countBy=rs,t.create=Xi,t.curry=ms,t.curryRight=bs,t.debounce=pi,t.defaults=Is,t.defaultsDeep=Cs,t.defer=ws,t.delay=ks,t.difference=Ju,t.drop=yr,t.dropRight=_r,t.dropRightWhile=gr,t.dropWhile=mr,t.fill=br,t.filter=Gr,t.flatten=kr,t.flattenDeep=Or,t.flow=Os,t.flowRight=Rs,t.forEach=us,t.forEachRight=ss,t.forIn=Ds,t.forInRight=Us,t.forOwn=$s,t.forOwnRight=Ls,t.functions=Qi,t.groupBy=as,t.indexBy=cs,t.initial=xr,t.intersection=Hu,t.invert=Yi,t.invoke=ls,t.keys=Fs,t.keysIn=eo,t.map=ei,t.mapKeys=Ws,t.mapValues=Bs,t.matches=To,t.matchesProperty=Po,t.memoize=di,t.merge=Ps,t.method=Zs,t.methodOf=Ys,t.mixin=So,t.modArgs=xs,t.negate=vi,t.omit=Ms,t.once=yi,t.pairs=to,t.partial=As,t.partialRight=js,t.partition=fs,t.pick=Js,t.pluck=ti,t.property=No,t.propertyOf=qo,t.pull=Er,t.pullAt=Vu,t.range=Do,t.rearg=Es,t.reject=ni,t.remove=Tr,t.rest=Pr,t.restParam=_i,t.set=ro,t.shuffle=ii,t.slice=Sr,t.sortBy=si,t.sortByAll=ds,t.sortByOrder=ai,t.spread=gi,t.take=Ir,t.takeRight=Cr,t.takeRightWhile=Nr,t.takeWhile=qr,t.tap=Br,t.throttle=mi,t.thru=Mr,t.times=Uo,t.toArray=Hi,t.toPlainObject=Vi,t.transform=io,t.union=Gu,t.uniq=Dr,t.unzip=Ur,t.unzipWith=$r,t.values=oo,t.valuesIn=uo,t.where=ci,t.without=Zu,
t.wrap=bi,t.xor=Lr,t.zip=Yu,t.zipObject=Fr,t.zipWith=es,t.backflow=Rs,t.collect=ei,t.compose=Rs,t.each=us,t.eachRight=ss,t.extend=Ss,t.iteratee=Ao,t.methods=Qi,t.object=Fr,t.select=Gr,t.tail=Pr,t.unique=Dr,So(t,t),t.add=Lo,t.attempt=Gs,t.camelCase=Ks,t.capitalize=co,t.ceil=ea,t.clone=wi,t.cloneDeep=ki,t.deburr=lo,t.endsWith=fo,t.escape=ho,t.escapeRegExp=po,t.every=Qr,t.find=is,t.findIndex=Ku,t.findKey=Ns,t.findLast=os,t.findLastIndex=zu,t.findLastKey=qs,t.findWhere=Zr,t.first=wr,t.floor=ta,t.get=Gi,t.gt=Oi,t.gte=Ri,t.has=Zi,t.identity=Eo,t.includes=Yr,t.indexOf=Rr,t.inRange=so,t.isArguments=xi,t.isArray=Ts,t.isBoolean=Ai,t.isDate=ji,t.isElement=Ei,t.isEmpty=Ti,t.isEqual=Pi,t.isError=Si,t.isFinite=Ii,t.isFunction=Ci,t.isMatch=qi,t.isNaN=Di,t.isNative=Ui,t.isNull=$i,t.isNumber=Li,t.isObject=Ni,t.isPlainObject=Fi,t.isRegExp=Wi,t.isString=Bi,t.isTypedArray=Mi,t.isUndefined=Ji,t.kebabCase=zs,t.last=Ar,t.lastIndexOf=jr,t.lt=Ki,t.lte=zi,t.max=na,t.min=ra,t.noConflict=Io,t.noop=Co,t.now=vs,t.pad=vo,t.padLeft=Hs,t.padRight=Vs,t.parseInt=yo,t.random=ao,t.reduce=hs,t.reduceRight=ps,t.repeat=_o,t.result=no,t.round=ia,t.runInContext=x,t.size=oi,t.snakeCase=Xs,t.some=ui,t.sortedIndex=Xu,t.sortedLastIndex=Qu,t.startCase=Qs,t.startsWith=go,t.sum=Fo,t.template=mo,t.trim=bo,t.trimLeft=wo,t.trimRight=ko,t.trunc=Oo,t.unescape=Ro,t.uniqueId=$o,t.words=xo,t.all=Qr,t.any=ui,t.contains=Yr,t.eq=Pi,t.detect=is,t.foldl=hs,t.foldr=ps,t.head=wr,t.include=Yr,t.inject=hs,So(t,function(){var e={};return St(t,function(n,r){t.prototype[r]||(e[r]=n)}),e}(),!1),t.sample=ri,t.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return ri(t,e)}):ri(this.value())},t.VERSION=j,tt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){t[e].placeholder=t}),tt(["drop","take"],function(e,t){m.prototype[e]=function(n){var r=this.__filtered__;if(r&&!t)return new m(this);n=null==n?1:ku(gu(n)||0,0);var i=this.clone();return r?i.__takeCount__=Ou(i.__takeCount__,n):i.__views__.push({size:n,type:e+(i.__dir__<0?"Right":"")}),i},m.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),tt(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n!=M;m.prototype[e]=function(e,t){var i=this.clone();return i.__iteratees__.push({iteratee:Wn(e,t,1),type:n}),i.__filtered__=i.__filtered__||r,i}}),tt(["first","last"],function(e,t){var n="take"+(t?"Right":"");m.prototype[e]=function(){return this[n](1).value()[0]}}),tt(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");m.prototype[e]=function(){return this.__filtered__?new m(this):this[n](1)}}),tt(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?Lt:No;m.prototype[e]=function(e){return this[n](r(e))}}),m.prototype.compact=function(){return this.filter(Eo)},m.prototype.reject=function(e,t){return e=Wn(e,t,1),this.filter(function(t){return!e(t)})},m.prototype.slice=function(e,t){e=null==e?0:+e||0;var n=this;return n.__filtered__&&(e>0||t<0)?new m(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==A&&(t=+t||0,n=t<0?n.dropRight(-t):n.take(t-e)),n)},m.prototype.takeRightWhile=function(e,t){return this.reverse().takeWhile(e,t).reverse()},m.prototype.toArray=function(){return this.take(Eu)},St(m.prototype,function(e,n){var i=/^(?:filter|map|reject)|While$/.test(n),o=/^(?:first|last)$/.test(n),u=t[o?"take"+("last"==n?"Right":""):n];u&&(t.prototype[n]=function(){var t=o?[1]:arguments,n=this.__chain__,s=this.__wrapped__,a=!!this.__actions__.length,c=s instanceof m,l=t[0],f=c||Ts(s);f&&i&&"function"==typeof l&&1!=l.length&&(c=f=!1);var h=function(e){return o&&n?u(e,1)[0]:u.apply(A,ct([e],t))},p={func:Mr,args:[h],thisArg:A},d=c&&!a;if(o&&!n)return d?(s=s.clone(),s.__actions__.push(p),e.call(s)):u.call(A,this.value())[0];if(!o&&f){s=d?s:new m(this);var v=e.apply(s,t);return v.__actions__.push(p),new r(v,n)}return this.thru(h)})}),tt(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var n=(/^(?:replace|split)$/.test(e)?Yo:Go)[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:join|pop|replace|shift)$/.test(e);t.prototype[e]=function(){var e=arguments;return i&&!this.__chain__?n.apply(this.value(),e):this[r](function(t){return n.apply(t,e)})}}),St(m.prototype,function(e,n){var r=t[n];if(r){var i=r.name,o=Nu[i]||(Nu[i]=[]);o.push({name:n,func:r})}}),Nu[In(A,T).name]=[{name:"wrapper",func:A}],m.prototype.clone=Z,m.prototype.reverse=ne,m.prototype.value=ie,t.prototype.chain=Jr,t.prototype.commit=Kr,t.prototype.concat=ts,t.prototype.plant=zr,t.prototype.reverse=Hr,t.prototype.toString=Vr,t.prototype.run=t.prototype.toJSON=t.prototype.valueOf=t.prototype.value=Xr,t.prototype.collect=t.prototype.map,t.prototype.head=t.prototype.first,t.prototype.select=t.prototype.filter,t.prototype.tail=t.prototype.rest,t}var A,j="3.10.1",E=1,T=2,P=4,S=8,I=16,C=32,N=64,q=128,D=256,U=30,$="...",L=150,F=16,W=200,B=1,M=2,J="Expected a function",K="__lodash_placeholder__",z="[object Arguments]",H="[object Array]",V="[object Boolean]",X="[object Date]",Q="[object Error]",G="[object Function]",Z="[object Map]",Y="[object Number]",ee="[object Object]",te="[object RegExp]",ne="[object Set]",re="[object String]",ie="[object WeakMap]",oe="[object ArrayBuffer]",ue="[object Float32Array]",se="[object Float64Array]",ae="[object Int8Array]",ce="[object Int16Array]",le="[object Int32Array]",fe="[object Uint8Array]",he="[object Uint8ClampedArray]",pe="[object Uint16Array]",de="[object Uint32Array]",ve=/\b__p \+= '';/g,ye=/\b(__p \+=) '' \+/g,_e=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ge=/&(?:amp|lt|gt|quot|#39|#96);/g,me=/[&<>"'`]/g,be=RegExp(ge.source),we=RegExp(me.source),ke=/<%-([\s\S]+?)%>/g,Oe=/<%([\s\S]+?)%>/g,Re=/<%=([\s\S]+?)%>/g,xe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,Ae=/^\w*$/,je=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Ee=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,Te=RegExp(Ee.source),Pe=/[\u0300-\u036f\ufe20-\ufe23]/g,Se=/\\(\\)?/g,Ie=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ce=/\w*$/,Ne=/^0[xX]/,qe=/^\[object .+?Constructor\]$/,De=/^\d+$/,Ue=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,$e=/($^)/,Le=/['\n\r\u2028\u2029\\]/g,Fe=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),We=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],Be=-1,Me={};Me[ue]=Me[se]=Me[ae]=Me[ce]=Me[le]=Me[fe]=Me[he]=Me[pe]=Me[de]=!0,Me[z]=Me[H]=Me[oe]=Me[V]=Me[X]=Me[Q]=Me[G]=Me[Z]=Me[Y]=Me[ee]=Me[te]=Me[ne]=Me[re]=Me[ie]=!1;var Je={};Je[z]=Je[H]=Je[oe]=Je[V]=Je[X]=Je[ue]=Je[se]=Je[ae]=Je[ce]=Je[le]=Je[Y]=Je[ee]=Je[te]=Je[re]=Je[fe]=Je[he]=Je[pe]=Je[de]=!0,Je[Q]=Je[G]=Je[Z]=Je[ne]=Je[ie]=!1;var Ke={"":"A","":"A","":"A","":"A","":"A","":"A"," ":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},ze={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},He={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Ve={"function":!0,object:!0},Xe={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Qe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ge=Ve[typeof r]&&r&&!r.nodeType&&r,Ze=Ve[typeof n]&&n&&!n.nodeType&&n,Ye=Ge&&Ze&&"object"==typeof t&&t&&t.Object&&t,et=Ve[typeof self]&&self&&self.Object&&self,tt=Ve[typeof window]&&window&&window.Object&&window,nt=Ze&&Ze.exports===Ge&&Ge,rt=Ye||tt!==(this&&this.window)&&tt||et||this,it=x();"function"==typeof e&&"object"==typeof e.amd&&e.amd?(rt._=it,e(function(){return it})):Ge&&Ze?nt?(Ze.exports=it)._=it:Ge._=it:rt._=it}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,t,n){!function(){var n=e("crypt"),r=e("charenc").utf8,i=e("is-buffer"),o=e("charenc").bin,u=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?o.stringToBytes(e):r.stringToBytes(e):i(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var s=n.bytesToWords(e),a=8*e.length,c=1732584193,l=-271733879,f=-1732584194,h=271733878,p=0;p<s.length;p++)s[p]=16711935&(s[p]<<8|s[p]>>>24)|4278255360&(s[p]<<24|s[p]>>>8);s[a>>>5]|=128<<a%32,s[(a+64>>>9<<4)+14]=a;for(var d=u._ff,v=u._gg,y=u._hh,_=u._ii,p=0;p<s.length;p+=16){var g=c,m=l,b=f,w=h;c=d(c,l,f,h,s[p+0],7,-680876936),h=d(h,c,l,f,s[p+1],12,-389564586),f=d(f,h,c,l,s[p+2],17,606105819),l=d(l,f,h,c,s[p+3],22,-1044525330),c=d(c,l,f,h,s[p+4],7,-176418897),h=d(h,c,l,f,s[p+5],12,1200080426),f=d(f,h,c,l,s[p+6],17,-1473231341),l=d(l,f,h,c,s[p+7],22,-45705983),c=d(c,l,f,h,s[p+8],7,1770035416),h=d(h,c,l,f,s[p+9],12,-1958414417),f=d(f,h,c,l,s[p+10],17,-42063),l=d(l,f,h,c,s[p+11],22,-1990404162),c=d(c,l,f,h,s[p+12],7,1804603682),h=d(h,c,l,f,s[p+13],12,-40341101),f=d(f,h,c,l,s[p+14],17,-1502002290),l=d(l,f,h,c,s[p+15],22,1236535329),c=v(c,l,f,h,s[p+1],5,-165796510),h=v(h,c,l,f,s[p+6],9,-1069501632),f=v(f,h,c,l,s[p+11],14,643717713),l=v(l,f,h,c,s[p+0],20,-373897302),c=v(c,l,f,h,s[p+5],5,-701558691),h=v(h,c,l,f,s[p+10],9,38016083),f=v(f,h,c,l,s[p+15],14,-660478335),l=v(l,f,h,c,s[p+4],20,-405537848),c=v(c,l,f,h,s[p+9],5,568446438),h=v(h,c,l,f,s[p+14],9,-1019803690),f=v(f,h,c,l,s[p+3],14,-187363961),l=v(l,f,h,c,s[p+8],20,1163531501),c=v(c,l,f,h,s[p+13],5,-1444681467),h=v(h,c,l,f,s[p+2],9,-51403784),f=v(f,h,c,l,s[p+7],14,1735328473),l=v(l,f,h,c,s[p+12],20,-1926607734),c=y(c,l,f,h,s[p+5],4,-378558),h=y(h,c,l,f,s[p+8],11,-2022574463),f=y(f,h,c,l,s[p+11],16,1839030562),l=y(l,f,h,c,s[p+14],23,-35309556),c=y(c,l,f,h,s[p+1],4,-1530992060),h=y(h,c,l,f,s[p+4],11,1272893353),f=y(f,h,c,l,s[p+7],16,-155497632),l=y(l,f,h,c,s[p+10],23,-1094730640),c=y(c,l,f,h,s[p+13],4,681279174),h=y(h,c,l,f,s[p+0],11,-358537222),f=y(f,h,c,l,s[p+3],16,-722521979),l=y(l,f,h,c,s[p+6],23,76029189),c=y(c,l,f,h,s[p+9],4,-640364487),h=y(h,c,l,f,s[p+12],11,-421815835),f=y(f,h,c,l,s[p+15],16,530742520),l=y(l,f,h,c,s[p+2],23,-995338651),c=_(c,l,f,h,s[p+0],6,-198630844),h=_(h,c,l,f,s[p+7],10,1126891415),f=_(f,h,c,l,s[p+14],15,-1416354905),l=_(l,f,h,c,s[p+5],21,-57434055),c=_(c,l,f,h,s[p+12],6,1700485571),h=_(h,c,l,f,s[p+3],10,-1894986606),f=_(f,h,c,l,s[p+10],15,-1051523),l=_(l,f,h,c,s[p+1],21,-2054922799),c=_(c,l,f,h,s[p+8],6,1873313359),h=_(h,c,l,f,s[p+15],10,-30611744),f=_(f,h,c,l,s[p+6],15,-1560198380),l=_(l,f,h,c,s[p+13],21,1309151649),c=_(c,l,f,h,s[p+4],6,-145523070),h=_(h,c,l,f,s[p+11],10,-1120210379),f=_(f,h,c,l,s[p+2],15,718787259),l=_(l,f,h,c,s[p+9],21,-343485551),c=c+g>>>0,l=l+m>>>0,f=f+b>>>0,h=h+w>>>0}return n.endian([c,l,f,h])};u._ff=function(e,t,n,r,i,o,u){var s=e+(t&n|~t&r)+(i>>>0)+u;return(s<<o|s>>>32-o)+t},u._gg=function(e,t,n,r,i,o,u){var s=e+(t&r|n&~r)+(i>>>0)+u;return(s<<o|s>>>32-o)+t},u._hh=function(e,t,n,r,i,o,u){var s=e+(t^n^r)+(i>>>0)+u;return(s<<o|s>>>32-o)+t},u._ii=function(e,t,n,r,i,o,u){var s=e+(n^(t|~r))+(i>>>0)+u;return(s<<o|s>>>32-o)+t},u._blocksize=16,u._digestsize=16,t.exports=function(e,t){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(u(e,t));return t&&t.asBytes?r:t&&t.asString?o.bytesToString(r):n.bytesToHex(r)}}()},{charenc:22,crypt:25,"is-buffer":41}],45:[function(t,n,r){(function(t){!function(i){function o(e){throw RangeError(N[e])}function u(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function s(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(C,".");var i=e.split("."),o=u(i,t).join(".");return r+o}function a(e){for(var t,n,r=[],i=0,o=e.length;i<o;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function c(e){return u(e,function(e){var t="";return e>65535&&(e-=65536,t+=U(e>>>10&1023|55296),e=56320|1023&e),t+=U(e)}).join("")}function l(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:O}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,n){var r=0;for(e=n?D(e/j):e>>1,e+=D(e/t);e>q*x>>1;r+=O)e=D(e/q);return D(r+(q+1)*e/(e+A))}function p(e){var t,n,r,i,u,s,a,f,p,d,v=[],y=e.length,_=0,g=T,m=E;for(n=e.lastIndexOf(P),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&o("not-basic"),v.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(u=_,s=1,a=O;i>=y&&o("invalid-input"),f=l(e.charCodeAt(i++)),(f>=O||f>D((k-_)/s))&&o("overflow"),_+=f*s,p=a<=m?R:a>=m+x?x:a-m,!(f<p);a+=O)d=O-p,s>D(k/d)&&o("overflow"),s*=d;t=v.length+1,m=h(_-u,t,0==u),D(_/t)>k-g&&o("overflow"),g+=D(_/t),_%=t,v.splice(_++,0,g)}return c(v)}function d(e){var t,n,r,i,u,s,c,l,p,d,v,y,_,g,m,b=[];for(e=a(e),y=e.length,t=T,n=0,u=E,s=0;s<y;++s)v=e[s],v<128&&b.push(U(v));for(r=i=b.length,i&&b.push(P);r<y;){for(c=k,s=0;s<y;++s)v=e[s],v>=t&&v<c&&(c=v);for(_=r+1,c-t>D((k-n)/_)&&o("overflow"),n+=(c-t)*_,t=c,s=0;s<y;++s)if(v=e[s],v<t&&++n>k&&o("overflow"),v==t){for(l=n,p=O;d=p<=u?R:p>=u+x?x:p-u,!(l<d);p+=O)m=l-d,g=O-d,b.push(U(f(d+m%g,0))),l=D(m/g);b.push(U(f(l,0))),u=h(n,_,r==i),n=0,++r}++n,++t}return b.join("")}function v(e){return s(e,function(e){return S.test(e)?p(e.slice(4).toLowerCase()):e})}function y(e){return s(e,function(e){return I.test(e)?"xn--"+d(e):e})}var _="object"==typeof r&&r&&!r.nodeType&&r,g="object"==typeof n&&n&&!n.nodeType&&n,m="object"==typeof t&&t;m.global!==m&&m.window!==m&&m.self!==m||(i=m);var b,w,k=2147483647,O=36,R=1,x=26,A=38,j=700,E=72,T=128,P="-",S=/^xn--/,I=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},q=O-R,D=Math.floor,U=String.fromCharCode;if(b={version:"1.3.2",ucs2:{decode:a,encode:c},decode:p,encode:d,toASCII:y,toUnicode:v},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return b});else if(_&&g)if(n.exports==_)g.exports=b;else for(w in b)b.hasOwnProperty(w)&&(_[w]=b[w]);else i.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],46:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var u={};if("string"!=typeof e||0===e.length)return u;var s=/\+/g;e=e.split(t);var a=1e3;o&&"number"==typeof o.maxKeys&&(a=o.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var l=0;l<c;++l){var f,h,p,d,v=e[l].replace(s,"%20"),y=v.indexOf(n);y>=0?(f=v.substr(0,y),h=v.substr(y+1)):(f=v,h=""),p=decodeURIComponent(f),d=decodeURIComponent(h),r(u,p)?i(u[p])?u[p].push(d):u[p]=[u[p],d]:u[p]=d}return u};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],47:[function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(u(e),function(u){var s=encodeURIComponent(i(u))+n;return o(e[u])?r(e[u],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[u]))}).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],48:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":46,"./encode":47}],49:[function(e,t,n){function r(){}function i(e){if(!v(e))return e;var t=[];for(var n in e)o(t,n,e[n]);return t.join("&")}function o(e,t,n){if(null!=n)if(Array.isArray(n))n.forEach(function(n){o(e,t,n)});else if(v(n))for(var r in n)o(e,t+"["+r+"]",n[r]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));else null===n&&e.push(encodeURIComponent(t))}function u(e){for(var t,n,r={},i=e.split("&"),o=0,u=i.length;o<u;++o)t=i[o],n=t.indexOf("="),n==-1?r[decodeURIComponent(t)]="":r[decodeURIComponent(t.slice(0,n))]=decodeURIComponent(t.slice(n+1));return r}function s(e){var t,n,r,i,o=e.split(/\r?\n/),u={};o.pop();for(var s=0,a=o.length;s<a;++s)n=o[s],t=n.indexOf(":"),r=n.slice(0,t).toLowerCase(),i=b(n.slice(t+1)),u[r]=i;return u}function a(e){return/[\/+]json\b/.test(e)}function c(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=s(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function l(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new c(n)}catch(r){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=r,n.xhr?(e.rawResponse="undefined"==typeof n.xhr.responseType?n.xhr.responseText:n.xhr.response,e.status=n.xhr.status?n.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),n.callback(e)}n.emit("response",t);var i;try{n._isResponseOK(t)||(i=new Error(t.statusText||"Unsuccessful HTTP response"),i.original=e,i.response=t,i.status=t.status)}catch(r){i=r}i?n.callback(i,t):n.callback(null,t)})}function f(e,t,n){var r=m("DELETE",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}var h;"undefined"!=typeof window?h=window:"undefined"!=typeof self?h=self:(console.warn("Using browser-only version of superagent in non-browser environment"),h=this);var p=e("emitter"),d=e("./request-base"),v=e("./is-object"),y=e("./is-function"),_=e("./response-base"),g=e("./should-retry"),m=n=t.exports=function(e,t){return"function"==typeof t?new n.Request("GET",e).end(t):1==arguments.length?new n.Request("GET",e):new n.Request(e,t)};n.Request=l,m.getXHR=function(){if(!(!h.XMLHttpRequest||h.location&&"file:"==h.location.protocol&&h.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only verison of superagent could not find XHR")};var b="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};m.serializeObject=i,m.parseString=u,m.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},m.serialize={"application/x-www-form-urlencoded":i,"application/json":JSON.stringify},m.parse={"application/x-www-form-urlencoded":u,"application/json":JSON.parse},_(c.prototype),c.prototype._parseBody=function(e){var t=m.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&a(this.type)&&(t=m.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},c.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,r="cannot "+t+" "+n+" ("+this.status+")",i=new Error(r);return i.status=this.status,i.method=t,i.url=n,i},m.Response=c,p(l.prototype),d(l.prototype),l.prototype.type=function(e){return this.set("Content-Type",m.types[e]||e),this},l.prototype.accept=function(e){return this.set("Accept",m.types[e]||e),this},l.prototype.auth=function(e,t,n){switch(n||(n={type:"function"==typeof btoa?"basic":"auto"}),n.type){case"basic":this.set("Authorization","Basic "+btoa(e+":"+t));break;case"auto":this.username=e,this.password=t}return this},l.prototype.query=function(e){return"string"!=typeof e&&(e=i(e)),e&&this._query.push(e),this},l.prototype.attach=function(e,t,n){if(this._data)throw Error("superagent can't mix .send() and .attach()");return this._getFormData().append(e,t,n||t.name),this},l.prototype._getFormData=function(){return this._formData||(this._formData=new h.FormData),this._formData},l.prototype.callback=function(e,t){if(this._maxRetries&&this._retries++<this._maxRetries&&g(e,t))return this._retry();var n=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),n(e,t)},l.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},l.prototype.buffer=l.prototype.ca=l.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},l.prototype.pipe=l.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},l.prototype._appendQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._sort){var t=this.url.indexOf("?");if(t>=0){var n=this.url.substring(t+1).split("&");y(this._sort)?n.sort(this._sort):n.sort(),this.url=this.url.substring(0,t)+"?"+n.join("&")}}},l.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},l.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||r,this._appendQueryString(),this._end()},l.prototype._end=function(){var e=this,t=this.xhr=m.getXHR(),n=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var n=t.readyState;if(n>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==n){var r;try{r=t.status}catch(i){r=0}if(!r){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var r=function(t,n){n.total>0&&(n.percent=n.loaded/n.total*100),n.direction=t,e.emit("progress",n)};if(this.hasListeners("progress"))try{t.onprogress=r.bind(null,"download"),t.upload&&(t.upload.onprogress=r.bind(null,"upload"))}catch(i){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(o){return this.callback(o)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof n&&!this._isHost(n)){var u=this._header["content-type"],s=this._serializer||m.serialize[u?u.split(";")[0]:""];!s&&a(u)&&(s=m.serialize["application/json"]),s&&(n=s(n))}for(var c in this.header)null!=this.header[c]&&t.setRequestHeader(c,this.header[c]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send("undefined"!=typeof n?n:null),this},m.get=function(e,t,n){var r=m("GET",e);return"function"==typeof t&&(n=t,t=null),t&&r.query(t),n&&r.end(n),r},m.head=function(e,t,n){var r=m("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.options=function(e,t,n){var r=m("OPTIONS",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.del=f,m["delete"]=f,m.patch=function(e,t,n){var r=m("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.post=function(e,t,n){var r=m("POST",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},m.put=function(e,t,n){var r=m("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}},{"./is-function":50,"./is-object":51,"./request-base":52,"./response-base":53,"./should-retry":54,emitter:23}],50:[function(e,t,n){function r(e){var t=i(e)?Object.prototype.toString.call(e):"";return"[object Function]"===t}var i=e("./is-object");t.exports=r},{"./is-object":51}],51:[function(e,t,n){function r(e){return null!==e&&"object"==typeof e}t.exports=r},{}],52:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}var o=e("./is-object");t.exports=r,r.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},r.prototype.parse=function(e){return this._parser=e,this},r.prototype.responseType=function(e){return this._responseType=e,this},r.prototype.serialize=function(e){return this._serializer=e,this},r.prototype.timeout=function(e){return e&&"object"==typeof e?("undefined"!=typeof e.deadline&&(this._timeout=e.deadline),"undefined"!=typeof e.response&&(this._responseTimeout=e.response),this):(this._timeout=e,this._responseTimeout=0,this)},r.prototype.retry=function(e){return 0!==arguments.length&&e!==!0||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this},r.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},r.prototype.then=function(e,t){if(!this._fullfilledPromise){var n=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){n.end(function(n,r){n?t(n):e(r)})})}return this._fullfilledPromise.then(e,t)},r.prototype["catch"]=function(e){return this.then(void 0,e)},r.prototype.use=function(e){return e(this),this},r.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},r.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},r.prototype.get=function(e){return this._header[e.toLowerCase()]},r.prototype.getHeader=r.prototype.get,r.prototype.set=function(e,t){if(o(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},r.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},r.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),o(e)){for(var n in e)this.field(n,e[n]);return this}if(Array.isArray(t)){for(var r in t)this.field(e,t[r]);return this}if(null===t||void 0===t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},r.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},r.prototype.withCredentials=function(){return this._withCredentials=!0,this},r.prototype.redirects=function(e){return this._maxRedirects=e,this},r.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},r.prototype.send=function(e){var t=o(e),n=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&o(this._data))for(var r in e)this._data[r]=e[r];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],"application/x-www-form-urlencoded"==n?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(n||this.type("json"),this)},r.prototype.sortQuery=function(e){return this._sort="undefined"==typeof e||e,this},r.prototype._timeoutError=function(e,t){if(!this._aborted){var n=new Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",this.timedout=!0,this.abort(),this.callback(n)}},r.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout)},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout)},this._responseTimeout))}},{"./is-object":51}],53:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}var o=e("./utils");t.exports=r,r.prototype.get=function(e){return this.header[e.toLowerCase()]},r.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=o.type(t);var n=o.params(t);for(var r in n)this[r]=n[r];this.links={};try{e.link&&(this.links=o.parseLinks(e.link))}catch(i){}},r.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e}},{"./utils":55}],54:[function(e,t,n){var r=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];t.exports=function(e,t){return!!(e&&e.code&&~r.indexOf(e.code))||(!!(t&&t.status&&t.status>=500)||!!(e&&"timeout"in e&&"ECONNABORTED"==e.code))}},{}],55:[function(e,t,n){n.type=function(e){return e.split(/ *; */).shift()},n.params=function(e){return e.split(/ *; */).reduce(function(e,t){var n=t.split(/ *= */),r=n.shift(),i=n.shift();return r&&i&&(e[r]=i),e},{})},n.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var n=t.split(/ *; */),r=n[0].slice(1,-1),i=n[1].split(/ *= */)[1].slice(1,-1);return e[i]=r,e},{})},n.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&delete e.cookie,e}},{}],56:[function(e,t,n){(function(e){var n,r=e.crypto||e.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var o=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],57:[function(e,t,n){function r(e,t,n){var r=t&&n||0,i=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[r+i++]=c[e])});i<16;)t[r+i++]=0;return t}function i(e,t){var n=t||0,r=a;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function o(e,t,n){var r=t&&n||0,o=t||[];e=e||{};var u=void 0!==e.clockseq?e.clockseq:p,s=void 0!==e.msecs?e.msecs:(new Date).getTime(),a=void 0!==e.nsecs?e.nsecs:v+1,c=s-d+(a-v)/1e4;if(c<0&&void 0===e.clockseq&&(u=u+1&16383),(c<0||s>d)&&void 0===e.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");
d=s,v=a,p=u,s+=122192928e5;var l=(1e4*(268435455&s)+a)%4294967296;o[r++]=l>>>24&255,o[r++]=l>>>16&255,o[r++]=l>>>8&255,o[r++]=255&l;var f=s/4294967296*1e4&268435455;o[r++]=f>>>8&255,o[r++]=255&f,o[r++]=f>>>24&15|16,o[r++]=f>>>16&255,o[r++]=u>>>8|128,o[r++]=255&u;for(var y=e.node||h,_=0;_<6;_++)o[r+_]=y[_];return t?t:i(o)}function u(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var u=0;u<16;u++)t[r+u]=o[u];return t||i(o)}for(var s=e("./rng"),a=[],c={},l=0;l<256;l++)a[l]=(l+256).toString(16).substr(1),c[a[l]]=l;var f=s(),h=[1|f[0],f[1],f[2],f[3],f[4],f[5]],p=16383&(f[6]<<8|f[7]),d=0,v=0,y=u;y.v1=o,y.v4=u,y.parse=r,y.unparse=i,t.exports=y},{"./rng":56}],58:[function(e,t,n){(function(e){function n(){if(e.Blob)try{return new Blob(["asdf"],{type:"text/plain"}),Blob}catch(t){}var n=e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder;return function(e,t){var r=new n,i=t.endings,o=t.type;if(i)for(var u=0,s=e.length;u<s;++u)r.append(e[u],i);else for(var u=0,s=e.length;u<s;++u)r.append(e[u]);return o?r.getBlob(o):r.getBlob()}}t.exports=n()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],59:[function(e,t,n){function r(e,t){var n;return n=t?new o(e,t):new o(e)}var i=function(){return this}(),o=i.WebSocket||i.MozWebSocket,u=e("./version");t.exports={w3cwebsocket:o?r:null,version:u}},{"./version":60}],60:[function(e,t,n){t.exports=e("../package.json").version},{"../package.json":61}],61:[function(e,t,n){t.exports={_args:[[{raw:"websocket@^1.0.23",scope:null,escapedName:"websocket",name:"websocket",rawSpec:"^1.0.23",spec:">=1.0.23 <2.0.0",type:"range"},"/home/travis/build/SkygearIO/skygear-SDK-JS"]],_from:"websocket@>=1.0.23 <2.0.0",_id:"websocket@1.0.23",_inCache:!0,_location:"/websocket",_nodeVersion:"0.10.45",_npmOperationalInternal:{host:"packages-16-east.internal.npmjs.com",tmp:"tmp/websocket-1.0.23.tgz_1463625793005_0.4532310354989022"},_npmUser:{name:"theturtle32",email:"brian@worlize.com"},_npmVersion:"2.15.1",_phantomChildren:{},_requested:{raw:"websocket@^1.0.23",scope:null,escapedName:"websocket",name:"websocket",rawSpec:"^1.0.23",spec:">=1.0.23 <2.0.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.23.tgz",_shasum:"20de8ec4a7126b09465578cd5dbb29a9c296aac6",_shrinkwrap:null,_spec:"websocket@^1.0.23",_where:"/home/travis/build/SkygearIO/skygear-SDK-JS",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:!1},contributors:[{name:"Iaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.4"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^0.0.1",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.11.2","jshint-stylish":"^1.0.2",tape:"^4.0.1"},directories:{lib:"./lib"},dist:{shasum:"20de8ec4a7126b09465578cd5dbb29a9c296aac6",tarball:"https://registry.npmjs.org/websocket/-/websocket-1.0.23.tgz"},engines:{node:">=0.8.0"},gitHead:"ba2fa7e9676c456bcfb12ad160655319af66faed",homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],name:"websocket",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.23"}},{}]},{},[8])(8)});
//# sourceMappingURL=skygear.min.js.map